<!DOCTYPE html><html lang="en-gb" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Using the BDC to populate user profiles from a SQL Server database - Part One - Toby Statham</title><meta name="description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world. In this first post I will detail&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"><meta property="og:title" content="Using the BDC to populate user profiles from a SQL Server database - Part One"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world. In this first post I will detail&hellip;"><meta property="og:url" content="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Using the BDC to populate user profiles from a SQL Server database - Part One"><meta name="twitter:description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world. In this first post I will detail&hellip;"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root {
               --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
               --heading-font: 'Playfair Display', serif;
               --logo-font: var(--body-font);
               --menu-font: var(--heading-font);
            }</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=076b19ff0048426f36c3ff3f27f97211"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"},"headline":"Using the BDC to populate user profiles from a SQL Server database - Part One","datePublished":"2007-05-15T11:00","dateModified":"2021-05-04T13:30","description":"I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world. In this first post I will detail&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="header" id="js-header"><div><a class="logo" href="https://wutek.co.uk/">Toby Statham</a><div class="search"><div class="search__overlay js-search-overlay"><form action="https://wutek.co.uk/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="Search articles..." aria-label="Search input" autofocus="autofocus"> <button class="search__submit" aria-label="Search">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div></div></header><main><article class="post"><header class="post__inner post__header--centered"><h1 class="h0 post__title">Using the BDC to populate user profiles from a SQL Server database - Part One</h1><div class="post__meta"><div class="post__meta__author"><div><a href="https://wutek.co.uk/authors/toby-statham/" class="post__author">Toby Statham</a> <time datetime="2007-05-15T11:00" class="post__date">May 15, 2007</time></div></div></div></header><div class="post__body"><div class="post__inner"><div class="post__entry"><p>I’m going to post a few articles about the process I went through to get this implemented.</p><p>There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world.</p><p>In this first post I will detail how to install and configure SSO.</p><p>You will only need to configure SSO if you are using SQL authentication to connect to SQL Server.</p><h2 id="initial-setup">Initial Setup</h2><p>I used multiple service accounts for my MOSS 2007 farm, to prevent a single point of failure. It can make installation a little more complex, but will provide a stable environment in the long run.</p><p>Below is a brief overview of the accounts that are needed for the SSO installation and configuration (For full details on all the accounts needed for a MOSS 2007 installation have a look here.</p><p><a href="http://technet2.microsoft.com/Office/en-us/library/798aa915-7025-4adc-a210-4f6ff14c43fc1033.mspx?mfr=true">http://technet2.microsoft.com/Office/en-us/library/798aa915-7025-4adc-a210-4f6ff14c43fc1033.mspx?mfr=true</a></p><p><em>mossuser-Setup</em></p><p>Used to run installs, you should use this account to log-on to your servers. It should be a local administrator of all your servers and have system administrator rights to the database.</p><p><em>mossuser-FarmAdmin</em></p><p>Used as the application pool for Central Administration and the process account for the Sharepoint Services Timer service. This account needs to be a member of the Logins, Dbcreator, Security Admin and DBO (for each database) roles</p><p><em>mossuser-SSPAppPool, mossuser-PortalAppPool, mossuser-OtherWebAppPool</em></p><p>All accounts that are used for web application pools will need to be able to administer SSO, this can be achieved by adding them to the mossgroup-SSOAdmin group.</p><p><em>mossuser-SSO</em></p><p>This account is used to run the SSO Service, it will need to be a local administrator of the master key server and have securityadministrator rights to the database <a href="#configure-sso-account">*</a></p><p><em>mossgroup-FarmAdmin</em></p><p>This group should be added to the “Farm administrator’s group” and should have the the mossuser-SSO account as a member. (It’s worth while adding all users that need to administer the farm to this group for ease of management)</p><p><em>mossgroup-SSOAdmin</em></p><p>This group is used for the “Single Sign-On Administrator Account” and “Enterprise Application Definition Administrator Account” settings in “Manage Server Settings for Single Sign-On” page. This will need to have the following accounts as members; mossuser-FarmAdmin, mossuser-SSO, mossuser-Setup, mossuser-SSPAppPool, mossuser-PortalAppPool, mossuser-OtherWebAppPool.</p><p>Depending on how you manage your MOSS 2007 environment I would also add the mossgroup-FarmAdmin as a member, this means that all Farm administrators will also be able to administer SSO</p><h2 id="configuration">Configuration</h2><h3 id="configure-the-sso-service">Configure the SSO Service</h3><ol><li><p>Locate the “Microsoft Single Sign-on Service” in Services</p><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoservice.jpg" data-is-external-image="true" alt="SSO Service"></figure><p></p></li><li><p>Right click on the service and select properties</p></li><li><p>On the “Log On” tab, select “This account” and enter the mossuser-SSO as the user in the format of <em>Domain\User</em></p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoserviceprops.jpg" data-is-external-image="true" alt="SSO Service Props"></figure><p></p><ol start="4"><li><p>Click the Apply button and then OK</p></li><li><p>Restart this service</p></li><li><p>Update the service account through Central Administration</p></li></ol><p><strong>VERY IMPORTANT</strong></p><p>I haven’t seen this documented anywhere, but you need to do this otherwise you will get the following error message when trying to configure SSO. This is only applicable if you are using multiple service accounts, if you are using one account that has local administrator rights and system administrator rights on the database this doesn’t occur</p><p><code>You do not have the rights to perfrom this action</code></p><p>In the event log the following error is logged</p><p><code>User DOMAIN\ mossuser-Setup failed to configure the single sign-on server. The error returned was 0x800708ad. Verify this account has sufficient permissions and try again.</code></p><ol><li><p>Go to the Central Administration site</p></li><li><p>In the Central Administration site, go to “Operations” and under “Security Configuration”, click on “Service accounts”</p></li><li><p>Select the “Windows Service” option and in the drop down, select “Single Sign-on Service”</p></li><li><p>Select the “Configurable” option and enter the mossuser-SSO user and password</p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/serviceaccount.jpg" data-is-external-image="true" alt="Service Account"></figure><p></p><ol start="5"><li>Click OK</li></ol><p>Secondly if you get this error message</p><p><code>Failed to connect to the database server. Verify connectivity and rights for the configuration account and try again.</code></p><p>You need to follow these instruction from the following MS KB article: <a href="http://support.microsoft.com/kb/901203">http://support.microsoft.com/kb/901203</a></p><h3 id="configure-the-sso-server">Configure the SSO Server</h3><ol><li><p>In the Central Administration site, go to “Operations” and under “Security Configuration”, click on “Manage settings for single sign-on” and then “Manage server settings”.</p></li><li><p>Enter DOMAIN\mossgroup-SSOAdmin for the “Single Sign-On Administrator Account” in the “Account name” box</p></li><li><p>Enter DOMAIN\mossgroup-SSOAdmin for the “Enterprise Application Definition Administrator Account” in the “Account name” box</p></li><li><p>Enter the database server name and the SSO database name for the “Database Settings” in the “Server name”and “Database name” boxes</p></li><li><p>Click OK</p></li><li><p>Click on “Manage encryption key” and then click on the “Create Encryption Key” (You can also backup your encryption key here if you need to)</p></li><li><p>Go back to the “Manage Single Sign-On” screen</p></li><li><p>Click on “Manage settings for enterprise application definitions”</p></li><li><p>Click on “New Item”</p></li><li><p>Enter a display name for the application in the “Display Name” box</p></li><li><p>Enter an application name for the application in the “Application name” box (You will use this name as the reference later on soI would make it small and easy to remember)</p></li><li><p>In the “Field 1: Display Name” , enter “User ID” and set “Mask” to “No”</p></li><li><p>In the “Field 2: Display Name”, enter “Password” and set “Mask” to “Yes”</p></li><li><p>Click OK</p><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoappadin.jpg" data-is-external-image="true" alt="SSO App Admin"></figure><p></p></li><li><p>Return back to the “Manage Single Sign-On” screen</p></li><li><p>Click “Manage account information for enterprise application definitions”</p></li><li><p>Enter the SQL account name in the “User ID” field</p></li><li><p>Enter the password for the SQL account in the “Password” field</p></li><li><p>Click OK</p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoappdef.jpg" data-is-external-image="true" alt="SSO App Def"></figure><p></p><p><strong>VERY IMPORTANT</strong></p><p>This is another task that I haven’t seen documented that needs to be done every time you create an encryption key</p><ol><li><p>Go to the Central Administration site</p></li><li><p>Under “Upgrade and Migration”, click “Enable features on existing sites”</p></li><li><p>Check “Enable all sites in this installation to use the following set of features” and click on OK. I think this must send out the new encryption key to the existing sites.</p></li></ol><h2 id="summary">Summary</h2><p>So I’m hoping now that you have SSO up and running!</p><p>In <a href="using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two.md">Part Two</a> I will detail how to set up the BDC.</p><h2 id="configure-sso-account">Configure SSO account</h2><p>If you are unable to give your SSO account security administrator rights on your database then you will need to do the following</p><ul><li><p>On a server that has MOSS 2007 installed, navigate to “C:\Program Files\Common Files\Microsoft Shared\Microsoft Office 12 Single Sign-on” and locate the sso_schema.sql file and take a copy.</p></li><li><p>Open up “Microsoft SQL Server Management Studio” and connect to your database server.</p></li><li><p>Create a database called SSO</p></li><li><p>Put the mossuser-SSO in the dbo role for this database</p></li><li><p>Make sure you have SSO selected as the database and then open the copied sso_schema.sql file.</p></li><li><p>Run the script</p></li></ul></div><footer class="post__footer"><div class="post__updated">Updated: <time datetime="2021-05-04T13:30">May 4, 2021</time></div><div class="post__meta"><div class="post__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section post__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/runas-method-for-running-code-in-specific-user-spservicecontext/" class="invert">RunAs method for running code in specific user SPServiceContext</a></h2><p>You may have the need to run some...</p><footer class="card__footer"><time datetime="2011-10-25T14:07">October 25, 2011 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Frunas-method-for-running-code-in-specific-user-spservicecontext%2F&title=RunAs%20method%20for%20running%20code%20in%20specific%20user%20SPServiceContext" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/finding-the-smtp-server-address-through-code-in-sharepoint-2010/" class="invert">Finding the SMTP server address through code in SharePoint 2010</a></h2><p>If anyone knows a better way then let...</p><footer class="card__footer"><time datetime="2011-02-13T11:23">February 13, 2011 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Ffinding-the-smtp-server-address-through-code-in-sharepoint-2010%2F&title=Finding%20the%20SMTP%20server%20address%20through%20code%20in%20SharePoint%202010" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/the-hidden-user-information-list-and-the-email-field/" class="invert">The hidden User Information List and the Email field</a></h2><p>More of a reminder to myself. The internal...</p><footer class="card__footer"><time datetime="2010-11-04T13:33">November 4, 2010 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fthe-hidden-user-information-list-and-the-email-field%2F&title=The%20hidden%20User%20Information%20List%20and%20the%20Email%20field" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/invalid-object-name-groups-when-using-psconfig/" class="invert">Invalid object name &#x27;Groups&#x27; when using PSCONFIG</a></h2><p>I have been trying to rebuild a development...</p><footer class="card__footer"><time datetime="2008-03-01T18:17">March 1, 2008 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Finvalid-object-name-groups-when-using-psconfig%2F&title=Invalid%20object%20name%20'Groups'%20when%20using%20PSCONFIG" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://wutek.co.uk/">Toby Statham</a><div class="footer__copyright"><p>Powered by Publii</p></div><div class="footer__nav"><ul class="footer__nav"><li><a href="https://wutek.co.uk/" target="_self">Home</a></li><li><a href="https://wutek.co.uk/tags/" target="_self">Tags</a></li><li><a href="https://wutek.co.uk/about-me/" target="_self">About</a></li></ul></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top"><svg><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#toparrow"/></svg></svg></button></footer><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=11cb42b202c1c2462a7002b62194e351"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>