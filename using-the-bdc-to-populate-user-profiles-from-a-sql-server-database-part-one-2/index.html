<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Using the BDC to populate user profiles from a SQL Server database - Part One - Toby Statham</title><meta name="description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><meta property="og:title" content="Using the BDC to populate user profiles from a SQL Server database - Part One"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented&hellip;"><meta property="og:url" content="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Using the BDC to populate user profiles from a SQL Server database - Part One"><meta name="twitter:description" content="I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented&hellip;"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=9b8c2c950ce971bb347897f7e2550d3d"><link rel="stylesheet" href="https://wutek.co.uk/assets/css/prism-dark.css?v=4cc85e12ca94c0614c9359a37eb69a0c"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/"},"headline":"Using the BDC to populate user profiles from a SQL Server database - Part One","datePublished":"2007-05-15T11:00","dateModified":"2021-05-04T13:30","description":"I’m going to post a few articles about the process I went through to get this implemented. There are a few things that aren’t documented&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="top"><div class="top__logo"><a class="logo" href="https://wutek.co.uk/">Toby Statham</a></div><div class="top__search search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><svg class="search__icon" role="presentation" height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg><form action="https://wutek.co.uk/search.html" class="search__form" role="search"><input type="search" name="q" placeholder="Search documentation ..." aria-label="Search" class="search__input js-search-input"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__button js-search-btn" aria-label="Search"><span>Search</span> <svg role="presentation" focusable="false" height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div><div class="top__links"><a href="https://github.com/statto1974" class="top__links-url" aria-label="Github" title="Github" target="_blank" rel="noopener"><svg height="24" width="24"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#github"></use></svg></a></div><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button></header><main class="main"><div class="main__left"><div class="main__left-inner"><div class="main__left-content"><article class="post"><header><h1 class="post__title">Using the BDC to populate user profiles from a SQL Server database - Part One</h1></header><div class="post__entry"><p>I’m going to post a few articles about the process I went through to get this implemented.</p><p>There are a few things that aren’t documented that I wanted to catch in these posts, to prevent any further hair loss in the Sharepoint world.</p><p>In this first post I will detail how to install and configure SSO.</p><p>You will only need to configure SSO if you are using SQL authentication to connect to SQL Server.</p><h2 id="initial-setup">Initial Setup</h2><p>I used multiple service accounts for my MOSS 2007 farm, to prevent a single point of failure. It can make installation a little more complex, but will provide a stable environment in the long run.</p><p>Below is a brief overview of the accounts that are needed for the SSO installation and configuration (For full details on all the accounts needed for a MOSS 2007 installation have a look here.</p><p><a href="http://technet2.microsoft.com/Office/en-us/library/798aa915-7025-4adc-a210-4f6ff14c43fc1033.mspx?mfr=true">http://technet2.microsoft.com/Office/en-us/library/798aa915-7025-4adc-a210-4f6ff14c43fc1033.mspx?mfr=true</a></p><p><em>mossuser-Setup</em></p><p>Used to run installs, you should use this account to log-on to your servers. It should be a local administrator of all your servers and have system administrator rights to the database.</p><p><em>mossuser-FarmAdmin</em></p><p>Used as the application pool for Central Administration and the process account for the Sharepoint Services Timer service. This account needs to be a member of the Logins, Dbcreator, Security Admin and DBO (for each database) roles</p><p><em>mossuser-SSPAppPool, mossuser-PortalAppPool, mossuser-OtherWebAppPool</em></p><p>All accounts that are used for web application pools will need to be able to administer SSO, this can be achieved by adding them to the mossgroup-SSOAdmin group.</p><p><em>mossuser-SSO</em></p><p>This account is used to run the SSO Service, it will need to be a local administrator of the master key server and have securityadministrator rights to the database <a href="#configure-sso-account">*</a></p><p><em>mossgroup-FarmAdmin</em></p><p>This group should be added to the “Farm administrator’s group” and should have the the mossuser-SSO account as a member. (It’s worth while adding all users that need to administer the farm to this group for ease of management)</p><p><em>mossgroup-SSOAdmin</em></p><p>This group is used for the “Single Sign-On Administrator Account” and “Enterprise Application Definition Administrator Account” settings in “Manage Server Settings for Single Sign-On” page. This will need to have the following accounts as members; mossuser-FarmAdmin, mossuser-SSO, mossuser-Setup, mossuser-SSPAppPool, mossuser-PortalAppPool, mossuser-OtherWebAppPool.</p><p>Depending on how you manage your MOSS 2007 environment I would also add the mossgroup-FarmAdmin as a member, this means that all Farm administrators will also be able to administer SSO</p><h2 id="configuration">Configuration</h2><h3 id="configure-the-sso-service">Configure the SSO Service</h3><ol><li><p>Locate the “Microsoft Single Sign-on Service” in Services</p><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoservice.jpg" data-is-external-image="true" alt="SSO Service"></figure><p></p></li><li><p>Right click on the service and select properties</p></li><li><p>On the “Log On” tab, select “This account” and enter the mossuser-SSO as the user in the format of <em>Domain\User</em></p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoserviceprops.jpg" data-is-external-image="true" alt="SSO Service Props"></figure><p></p><ol start="4"><li><p>Click the Apply button and then OK</p></li><li><p>Restart this service</p></li><li><p>Update the service account through Central Administration</p></li></ol><p><strong>VERY IMPORTANT</strong></p><p>I haven’t seen this documented anywhere, but you need to do this otherwise you will get the following error message when trying to configure SSO. This is only applicable if you are using multiple service accounts, if you are using one account that has local administrator rights and system administrator rights on the database this doesn’t occur</p><p><code>You do not have the rights to perfrom this action</code></p><p>In the event log the following error is logged</p><p><code>User DOMAIN\ mossuser-Setup failed to configure the single sign-on server. The error returned was 0x800708ad. Verify this account has sufficient permissions and try again.</code></p><ol><li><p>Go to the Central Administration site</p></li><li><p>In the Central Administration site, go to “Operations” and under “Security Configuration”, click on “Service accounts”</p></li><li><p>Select the “Windows Service” option and in the drop down, select “Single Sign-on Service”</p></li><li><p>Select the “Configurable” option and enter the mossuser-SSO user and password</p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/serviceaccount.jpg" data-is-external-image="true" alt="Service Account"></figure><p></p><ol start="5"><li>Click OK</li></ol><p>Secondly if you get this error message</p><p><code>Failed to connect to the database server. Verify connectivity and rights for the configuration account and try again.</code></p><p>You need to follow these instruction from the following MS KB article: <a href="http://support.microsoft.com/kb/901203">http://support.microsoft.com/kb/901203</a></p><h3 id="configure-the-sso-server">Configure the SSO Server</h3><ol><li><p>In the Central Administration site, go to “Operations” and under “Security Configuration”, click on “Manage settings for single sign-on” and then “Manage server settings”.</p></li><li><p>Enter DOMAIN\mossgroup-SSOAdmin for the “Single Sign-On Administrator Account” in the “Account name” box</p></li><li><p>Enter DOMAIN\mossgroup-SSOAdmin for the “Enterprise Application Definition Administrator Account” in the “Account name” box</p></li><li><p>Enter the database server name and the SSO database name for the “Database Settings” in the “Server name”and “Database name” boxes</p></li><li><p>Click OK</p></li><li><p>Click on “Manage encryption key” and then click on the “Create Encryption Key” (You can also backup your encryption key here if you need to)</p></li><li><p>Go back to the “Manage Single Sign-On” screen</p></li><li><p>Click on “Manage settings for enterprise application definitions”</p></li><li><p>Click on “New Item”</p></li><li><p>Enter a display name for the application in the “Display Name” box</p></li><li><p>Enter an application name for the application in the “Application name” box (You will use this name as the reference later on soI would make it small and easy to remember)</p></li><li><p>In the “Field 1: Display Name” , enter “User ID” and set “Mask” to “No”</p></li><li><p>In the “Field 2: Display Name”, enter “Password” and set “Mask” to “Yes”</p></li><li><p>Click OK</p><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoappadin.jpg" data-is-external-image="true" alt="SSO App Admin"></figure><p></p></li><li><p>Return back to the “Manage Single Sign-On” screen</p></li><li><p>Click “Manage account information for enterprise application definitions”</p></li><li><p>Enter the SQL account name in the “User ID” field</p></li><li><p>Enter the password for the SQL account in the “Password” field</p></li><li><p>Click OK</p></li></ol><p></p><figure class="post__image"><img loading="lazy" src="/images/ssoappdef.jpg" data-is-external-image="true" alt="SSO App Def"></figure><p></p><p><strong>VERY IMPORTANT</strong></p><p>This is another task that I haven’t seen documented that needs to be done every time you create an encryption key</p><ol><li><p>Go to the Central Administration site</p></li><li><p>Under “Upgrade and Migration”, click “Enable features on existing sites”</p></li><li><p>Check “Enable all sites in this installation to use the following set of features” and click on OK. I think this must send out the new encryption key to the existing sites.</p></li></ol><h2 id="summary">Summary</h2><p>So I’m hoping now that you have SSO up and running!</p><p>In <a href="using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two.md">Part Two</a> I will detail how to set up the BDC.</p><h2 id="configure-sso-account">Configure SSO account</h2><p>If you are unable to give your SSO account security administrator rights on your database then you will need to do the following</p><ul><li><p>On a server that has MOSS 2007 installed, navigate to “C:\Program Files\Common Files\Microsoft Shared\Microsoft Office 12 Single Sign-on” and locate the sso_schema.sql file and take a copy.</p></li><li><p>Open up “Microsoft SQL Server Management Studio” and connect to your database server.</p></li><li><p>Create a database called SSO</p></li><li><p>Put the mossuser-SSO in the dbo role for this database</p></li><li><p>Make sure you have SSO selected as the database and then open the copied sso_schema.sql file.</p></li><li><p>Run the script</p></li></ul></div><footer><div class="post__footer-top"><div class="post__meta"><time datetime="2007-05-15T11:00">May 15, 2007 </time>by <a href="https://wutek.co.uk/authors/toby-statham/" rel="author" title="Toby Statham">Toby Statham </a><span>Updated on: <time datetime="2021-05-04T13:30">May 4, 2021</time></span></div><div class="post__share"><button class="post__share-button js-post__share-button" aria-label="Share"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#share"></use></svg></button><div class="post__share-popup js-post__share-popup"><a href="https://twitter.com/share?url=https%3A%2F%2Fwutek.co.uk%2Fusing-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2%2F&amp;via=%40this_is_wutek&amp;text=Using%20the%20BDC%20to%20populate%20user%20profiles%20from%20a%20SQL%20Server%20database%20-%20Part%20One" class="js-share twitter" title="Share with Twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#twitter"/></svg> Twitter </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwutek.co.uk%2Fusing-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2%2F&amp;title=Using%20the%20BDC%20to%20populate%20user%20profiles%20from%20a%20SQL%20Server%20database%20-%20Part%20One" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#linkedin"/></svg> LinkedIn</a></div></div></div><div class="post__footer-bottom"><div class="post__bio"><p><a href="https://wutek.co.uk/authors/toby-statham/"><strong>Toby Statham</strong> </a>Independent Microsoft 365 / SharePoint / Power Platform Specialist and an associate consultant at Aiimi, an Information Management company</p></div></div></footer></article><nav><ul class="posts-nav"><li class="posts-nav__prev"><span>Previous: </span><a href="https://wutek.co.uk/sso-configuration/" class="invert" rel="prev" title="SSO Configuration">SSO Configuration</a></li><li class="posts-nav__next"><span>Next: </span><a href="https://wutek.co.uk/indexing-external-content-with-a-case-sensitive-url/" class="invert" rel="next" title="Indexing external content with a case sensitive URL">Indexing external content with a case sensitive URL</a></li></ul></nav><div class="post-comments" id="post-comments"><div id="disqus_thread"></div><script>var disqus_config = function () {
                             this.page.url = 'https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-one-2/';
                     		this.page.identifier = '40';
                         };
                     
                         var disqus_loaded = false;
                     
                         function publiiLoadDisqus() {
                             if(disqus_loaded) {
                                 return false;
                             }
                     
                             var top = document.getElementById('disqus_thread').offsetTop;
                     
                             if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                                 disqus_loaded = true;
                     
                                 (function () {
                                     var d = document, s = d.createElement('script');
                                     s.src = 'https://wutek.disqus.com/embed.js';
                                     s.setAttribute('data-timestamp', +new Date());
                                     (d.head || d.body).appendChild(s);
                                 })();
                             }
                         }
                     
                         publiiLoadDisqus();
                     
                         window.onscroll = function() {
                             publiiLoadDisqus();
                         };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><aside class="main__left-aside"><div class="main__left-aside__inner"><h3>On this page</h3><nav class="aside-toc" id="aside-toc"></nav></div></aside></div></div><div class="main__right"><div class="main__right-inner"><nav class="navbar"><ul class="navbar__menu"><li><a href="https://wutek.co.uk/" target="_self">Home</a></li><li><a href="https://wutek.co.uk/tags/" target="_self">Tags</a></li><li><a href="https://wutek.co.uk/about-me/" target="_self">About</a></li></ul></nav><div class="footer main__right-footer"><div class="footer__copy">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></div></div></div></div></main><footer class="footer"><div class="footer__wrap"><div class="footer__inner"><div class="footer__copy">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></div></div></div></footer><div class="post__progress" id="js-post__progress" aria-hidden="true"></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',        
        submenuWidth: 300,        
        mobileMenuExpandableSubmenus: true,
        isHoverMenu: false,
        ariaButtonAttribute: 'aria-expanded',
   };</script><script src="https://wutek.co.uk/assets/js/html-contents.min.js?v=169077c370ab8ca62b029845f80f7fd5" defer="defer"></script><script>document.addEventListener("DOMContentLoaded", function(event) {
            htmlContents('#aside-toc', {
                area: '.post__entry',
                top: 2,
                bottom: 3,
                listType: 'o',
                filter: function(arr) {
                    return !arr.matches('.noOutline')
                },
                addIds: true,
                addLinks: true
            });

            setTimeout(function() {
                handleActiveClass('#aside-toc');
            }, 0);
        })</script><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=2e5cce97094c516b8f7e6af7e7cd3e09"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://wutek.co.uk/assets/js/prism.js?v=277309e26a038bf312a7e8aa239cfbd8"></script><script defer="defer" src="https://wutek.co.uk/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://wutek.co.uk/assets/js/prism-copy-to-clipboard.min.js?v=fabfc3fd9af83cda5208ba2e9f9ed238"></script></body></html>