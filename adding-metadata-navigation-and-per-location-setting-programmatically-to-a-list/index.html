<!DOCTYPE html><html lang="en-gb" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Adding Metadata navigation and per-location setting programmatically to a list - Toby Statham</title><meta name="description" content="This turned out to be harder than I thought. Metadata navigation and per-location views are an little known, but powerful way of making lists more useful. It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/adding-metadata-navigation-and-per-location-setting-programmatically-to-a-list/"><meta property="og:title" content="Adding Metadata navigation and per-location setting programmatically to a list"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="This turned out to be harder than I thought. Metadata navigation and per-location views are an little known, but powerful way of making lists more useful. It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users&hellip;"><meta property="og:url" content="https://wutek.co.uk/adding-metadata-navigation-and-per-location-setting-programmatically-to-a-list/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Adding Metadata navigation and per-location setting programmatically to a list"><meta name="twitter:description" content="This turned out to be harder than I thought. Metadata navigation and per-location views are an little known, but powerful way of making lists more useful. It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users&hellip;"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root {
               --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
               --heading-font: 'Playfair Display', serif;
               --logo-font: var(--body-font);
               --menu-font: var(--heading-font);
            }</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=076b19ff0048426f36c3ff3f27f97211"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/adding-metadata-navigation-and-per-location-setting-programmatically-to-a-list/"},"headline":"Adding Metadata navigation and per-location setting programmatically to a list","datePublished":"2013-03-21T11:57","dateModified":"2021-05-04T10:38","description":"This turned out to be harder than I thought. Metadata navigation and per-location views are an little known, but powerful way of making lists more useful. It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="header" id="js-header"><div><a class="logo" href="https://wutek.co.uk/">Toby Statham</a><div class="search"><div class="search__overlay js-search-overlay"><form action="https://wutek.co.uk/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="Search articles..." aria-label="Search input" autofocus="autofocus"> <button class="search__submit" aria-label="Search">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div></div></header><main><article class="post"><header class="post__inner post__header--centered"><h1 class="h0 post__title">Adding Metadata navigation and per-location setting programmatically to a list</h1><div class="post__meta"><div class="post__meta__author"><div><a href="https://wutek.co.uk/authors/toby-statham/" class="post__author">Toby Statham</a> <time datetime="2013-03-21T11:57" class="post__date">March 21, 2013</time></div></div></div></header><div class="post__body"><div class="post__inner"><div class="post__entry"><p>This turned out to be harder than I thought.</p><p>Metadata navigation and per-location views are an  little known, but powerful way of making lists more useful.</p><p>It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users to navigate using a Taxonomy field. Dependent on the selected field, I would like to show different fields using a view.</p><p>The first part is to add the Metadata navigation.</p><p>This is done by creating a hierarchy using MetadataNavigationHierarchy</p><pre><code class="language-csharp">
  var list = SPContext.Current.Web.Lists.TryGetList("MyList");
  var field = list.Fields.TryGetFieldByStaticName("MyField");
  var settings = MetadataNavigationSettings.GetMetadataNavigationSettings(list);
  var hierarchy = settings.FindConfiguredHierarchy(field.Id);

  if (hierarchy == null)
  {
  	hierarchy = new MetadataNavigationHierarchy(field);
  	settings.AddConfiguredHierarchy(hierarchy);
  }
  MetadataNavigationSettings.SetMetadataNavigationSettings(list, settings);
</code></pre><p>The hard part is adding the settings for the per location views.</p><p>This can only be done by injecting XML into the settings XML. MetadataNavigationSettings is a wrapper class around an XML snippet that is stored in a hidden property of the root folder of the list.</p><p>Have a look at SPList.RootFolder.Properties["client_MOSS_MetadataNavigationSettings"]</p><p>The XML Schema is as follows. Haven't found anything documenting this schema on MSDN yet, so this is just taken from my configuration of my list, so may differ on yours</p><pre><code class="language-markup">
&lt;MetadataNavigationSettings SchemaVersion="1" IsEnabled="True"
AutoIndex="True"&gt;
&lt;NavigationHierarchies&gt;
&lt;FolderHierarchy HideFoldersNode="True" /&gt;
&lt;MetadataField FieldID="a96cea49-ef78-4bfa-8a69-2c49071155fb"
FieldType="TaxonomyFieldType"
CachedName="Legal_x0020_Document_x0020_Category"
CachedDisplayName="Legal Document Category"&gt;
&lt;ViewSettings UniqueNodeId="eadcb112-33af-4700-ad11-8e6afbd800e6"&gt;
&lt;View ViewId="4f4d05f4-046f-4bfa-a37c-170847fd4e34"
CachedName="My Custom View" Index="0"
CachedUrl="Store/Forms/My Custom View.aspx" /&gt;
&lt;View ViewId="a1ab958f-40d5-4e4a-ac3f-a10bc3cd22d2"
CachedName="My Other Custom View" Index="1"
CachedUrl="Store/Forms/AllItems.aspx" /&gt;
&lt;View ViewId="5c9447a3-ff59-419a-92b1-c7f0191d6f82"
CachedName="Not visisible view" Index="-1"
CachedUrl="Store/Forms/Not visisible view.aspx" /&gt;
&lt;/ViewSettings&gt;
&lt;/MetadataField&gt;
&lt;/NavigationHierarchies&gt;
&lt;KeyFilters /&gt;
&lt;ManagedIndices&gt;
&lt;ManagedIndex IndexID="a96cea49-ef78-4bfa-8a69-2c49071155fb"
IndexFieldName="Legal_x0020_Document_x0020_Category"
IndexFieldID="a96cea49-ef78-4bfa-8a69-2c49071155fb" /&gt;
&lt;/ManagedIndices&gt;
&lt;ViewSettings UniqueNodeId=""&gt;
&lt;View ViewId="a1ab958f-40d5-4e4a-ac3f-a10bc3cd22d2"
CachedName="All Documents" Index="0"
CachedUrl="Store/Forms/AllItems.aspx" /&gt;
&lt;/ViewSettings&gt;
&lt;/MetadataNavigationSettings&gt;
</code></pre><p>The part I'm interested in here is the ViewSettings and View tag. The UniqueId attribute relates to the GUID of the selected Term GUID. So this will show the views defined using the View tag when the Term is selected in the Metadata navigation.</p><p>If a View tag is added with 0 index this will be used as the default view when the term is selected, all other positive numbers will be shown in the order defined as other available views for that Term. Any negatives will not be available (You don't need to add them)</p><p>I used the following code to add these nodes programmaticallty using XLinq</p><p><code class="language-csharp"><br>var list = SPContext.Current.Web.Lists.TryGetList("MyList");<br>var view = list.Views.Cast().SingleOrDefault(v =&gt; v.Title == "MyView");<br>var session = new TaxonomySession(SPContext.Current.Site);<br>var field = list.Fields.TryGetFieldByStaticName("MyField");<br>var term = session.GetTerm("a96cea49-ef78-4bfa-8a69-2c49071155fb");<br>var settings = MetadataNavigationSettings.GetMetadataNavigationSettings(list);<br>var doc = XDocument.Parse(settings.SettingsXml);<br>var metaDataField = (from f in doc.Descendants("MetadataField")<br>let fieldId = f.Attribute("FieldID")<br>where fieldId != null &amp;&amp; fieldId.Value == field.Id.ToString()<br>select f).SingleOrDefault();<br>if (metaDataField != null)<br>{<br>  var viewSettings = (from v in metaDataField.Elements("ViewSettings")<br>  let uniqueNodeId = v.Attribute("UniqueNodeId")<br>    where uniqueNodeId != null &amp;&amp; uniqueNodeId.Value == term.Id.ToString()<br>    select v).SingleOrDefault();<br>  if (viewSettings == null)<br>  {<br>metaDataField.Add(<br>new XElement("ViewSettings",<br>new XAttribute("UniqueNodeId", term.Id.ToString()),<br>new XElement("View",<br>new XAttribute("ViewId", view.ID.ToString()),<br>new XAttribute("CachedName", view.Title),<br>new XAttribute("Index", "0"),<br>new XAttribute("CachedUrl", view.Url)<br>)<br>)<br>);<br>}<br>}<br>settings = new MetadataNavigationSettings(doc.ToString());<br>MetadataNavigationSettings.SetMetadataNavigationSettings(list, settings);<br></code></p></div><footer class="post__footer"><div class="post__updated">Updated: <time datetime="2021-05-04T10:38">May 4, 2021</time></div><div class="post__tag"><span>Tags:</span><ul class="post__tag__list"><li><a href="https://wutek.co.uk/tags/metadata/" title="Metadata">Metadata</a></li><li><a href="https://wutek.co.uk/tags/sharepoint2010/" title="SharePoint2010">SharePoint2010</a></li><li><a href="https://wutek.co.uk/tags/taxonomy/" title="Taxonomy">Taxonomy</a></li></ul></div><div class="post__meta"><div class="post__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section post__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/showing-a-listview-commandset-if-a-user-is-in-a-sharepoint-group/" class="invert">Showing a ListView CommandSet if a user is in a SharePoint Group</a></h2><p>This post is about creating a ListView CommandSet...</p><footer class="card__footer"><time datetime="2019-07-08T09:26">July 8, 2019 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fshowing-a-listview-commandset-if-a-user-is-in-a-sharepoint-group%2F&title=Showing%20a%20ListView%20CommandSet%20if%20a%20user%20is%20in%20a%20SharePoint%20Group" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/field-in-list-not-available-in-listitem-using-managed-client-object-model/" class="invert">Field in List not available in ListItem using Managed Client Object Model</a></h2><p>If you have a field called &quot;Folder&quot; it...</p><footer class="card__footer"><time datetime="2013-01-25T15:17">January 25, 2013 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Ffield-in-list-not-available-in-listitem-using-managed-client-object-model%2F&title=Field%20in%20List%20not%20available%20in%20ListItem%20using%20Managed%20Client%20Object%20Model" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/hack-attack-jquery-in-a-list-view/" class="invert">&quot;Hack attack&quot; jQuery in a list view</a></h2><p>Useful jQuery snippet to add a &quot;View Properties&quot;...</p><footer class="card__footer"><time datetime="2012-07-09T11:40">July 9, 2012 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fhack-attack-jquery-in-a-list-view%2F&title=%22Hack%20attack%22%20jQuery%20in%20a%20list%20view" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/beware-of-deleting-global-navigation-nodes-in-spwebnavigationglobalnodes/" class="invert">Beware of deleting Global Navigation nodes in SPWeb.Navigation.GlobalNodes</a></h2><p>For a standard team site (STS#0) the GlobalNodes SPNavigationNodesCollection...</p><footer class="card__footer"><time datetime="2008-04-09T08:50">April 9, 2008 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fbeware-of-deleting-global-navigation-nodes-in-spwebnavigationglobalnodes%2F&title=Beware%20of%20deleting%20Global%20Navigation%20nodes%20in%20SPWeb.Navigation.GlobalNodes" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://wutek.co.uk/">Toby Statham</a><div class="footer__copyright"><p>Powered by Publii</p></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top"><svg><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#toparrow"/></svg></svg></button></footer><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=11cb42b202c1c2462a7002b62194e351"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>