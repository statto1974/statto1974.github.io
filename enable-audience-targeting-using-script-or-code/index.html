<!DOCTYPE html><html lang="en-gb" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Enable Audience targeting using script or code - Toby Statham</title><meta name="description" content="Currently there are no direct methods to enable Audience Targeting on a List or Library via script or code. This is currently done through the List or Library Settings screen under Audience targetting settings option When you enable audience targeting through these settings, a field is created in the corresponding&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/enable-audience-targeting-using-script-or-code/"><meta property="og:title" content="Enable Audience targeting using script or code"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="Currently there are no direct methods to enable Audience Targeting on a List or Library via script or code. This is currently done through the List or Library Settings screen under Audience targetting settings option When you enable audience targeting through these settings, a field is created in the corresponding&hellip;"><meta property="og:url" content="https://wutek.co.uk/enable-audience-targeting-using-script-or-code/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Enable Audience targeting using script or code"><meta name="twitter:description" content="Currently there are no direct methods to enable Audience Targeting on a List or Library via script or code. This is currently done through the List or Library Settings screen under Audience targetting settings option When you enable audience targeting through these settings, a field is created in the corresponding&hellip;"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root {
               --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
               --heading-font: 'Playfair Display', serif;
               --logo-font: var(--body-font);
               --menu-font: var(--heading-font);
            }</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=076b19ff0048426f36c3ff3f27f97211"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/enable-audience-targeting-using-script-or-code/"},"headline":"Enable Audience targeting using script or code","datePublished":"2019-07-18T09:26","dateModified":"2021-05-04T09:08","description":"Currently there are no direct methods to enable Audience Targeting on a List or Library via script or code. This is currently done through the List or Library Settings screen under Audience targetting settings option When you enable audience targeting through these settings, a field is created in the corresponding&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="header" id="js-header"><div><a class="logo" href="https://wutek.co.uk/">Toby Statham</a><div class="search"><div class="search__overlay js-search-overlay"><form action="https://wutek.co.uk/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="Search articles..." aria-label="Search input" autofocus="autofocus"> <button class="search__submit" aria-label="Search">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div></div></header><main><article class="post"><header class="post__inner post__header--centered"><h1 class="h0 post__title">Enable Audience targeting using script or code</h1><div class="post__meta"><div class="post__meta__author"><div><a href="https://wutek.co.uk/authors/toby-statham/" class="post__author">Toby Statham</a> <time datetime="2019-07-18T09:26" class="post__date">July 18, 2019</time></div></div></div></header><div class="post__body"><div class="post__inner"><div class="post__entry"><p>Currently there are no direct methods to enable <strong>Audience Targeting</strong> on a <strong>List</strong> or <strong>Library</strong> via script or code.</p><p>This is currently done through the List or Library Settings screen under <strong>Audience targetting</strong> settings option</p><p></p><figure class="post__image"><img loading="lazy" src="https://wutek.co.uk/media/posts/38/settings.jpg" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://wutek.co.uk/media/posts/38/responsive/settings-xs.jpg 300w, https://wutek.co.uk/media/posts/38/responsive/settings-sm.jpg 480w, https://wutek.co.uk/media/posts/38/responsive/settings-md.jpg 768w, https://wutek.co.uk/media/posts/38/responsive/settings-xl.jpg 1200w" alt="Image description" width="990" height="200"></figure><p></p><p>When you enable audience targeting through these settings, a field is created in the corresponding <strong>List</strong> or <strong>Library</strong> called <strong>Target Audiences</strong></p><p>Using the <code>Get-PnpField</code> PnP PowerShell command to get the <code>SchemaXml</code> property we can see how the field is constructed.</p><pre><code class="language-ps">(Get-PnPField -Identity &quot;Target Audiences&quot; -List Documents).SchemaXml</code></pre><p>This is the XML returned</p><pre><code class="language-xml">
&lt;Field 
  ID=&quot;{61cbb965-1e04-4273-b658-eedaa662f48d}&quot; 
  Type=&quot;TargetTo&quot; 
  Name=&quot;Target_x0020_Audiences&quot; 
  DisplayName=&quot;Target Audiences&quot; 
  Required=&quot;FALSE&quot; 
  SourceID=&quot;{803a362c-54fb-47c7-83c8-e7a83a9512f8}&quot; 
  StaticName=&quot;Target_x0020_Audiences&quot; 
  ColName=&quot;ntext2&quot; 
  RowOrdinal=&quot;0&quot; Version=&quot;2&quot;&gt;
  &lt;Customization&gt;
    &lt;ArrayOfProperty&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowGlobalAudience&lt;/Name&gt;
        &lt;Value xmlns:q1=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q1:bo
olean&quot; xmlns:p4=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowDL&lt;/Name&gt;
        &lt;Value xmlns:q2=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q2:boolean&quot; xmlns:p4=&quot;http://www.w
3.org/2001/XMLSchema-instance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowSPGroup&lt;/Name&gt;
        &lt;Value xmlns:q3=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q3:boolean&quot; xmlns:p4=&quot;http://www.w3.org/2001/XMLSchema-ins
tance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
    &lt;/ArrayOfProperty&gt;
  &lt;/Customization&gt;
&lt;/Field&gt;</code></pre><p>After some experimenting, I found that the only two columns you need to set are the <code>ID</code> and <code>Type</code></p><blockquote><p><code>ID</code> needs to have <strong>61cbb965-1e04-4273-b658-eedaa662f48d</strong> set as it’s value</p><p><code>Type</code> needs to have <strong>TargetTo</strong> set as it’s value</p></blockquote><p>You still need to provide values for <code>Name</code>, <code>DisplayName</code>, <code>StaticName</code>, but they can be whatever you want.</p><p>Don’t like the name <strong>Target Audiences</strong> then you can change it to something else. The great thing is, it can still be turned off through the List or Library settings page.</p><p>To enable Audinence targeting using PnP PowerShell it’s as simple as running this script.</p><pre><code class="language-ps">
$credentials = (Get-Credential)

Connect-PnPOnline -Url https://contoso.sharepoint.com/sites/somesite -Credentials $credentials

Add-PnPFieldFromXml &#39;&lt;Field ID=&quot;{61cbb965-1e04-4273-b658-eedaa662f48d}&quot; Type=&quot;TargetTo&quot; Name=&quot;Target_x0020_Audiences&quot; StaticName=&quot;Target_x0020_Audiences&quot; DisplayName=&quot;Target Audiences&quot; /&gt;&#39; -List Documents</code></pre><p>And to do the same thing in C# CSOM</p><pre><code class="language-cs">
// from SharePointPnPCoreOnline Nuget package
var manager = new OfficeDevPnP.Core.AuthenticationManager();

string siteUrl = &quot;https://contoso.sharepoint.com/sites/somesite&quot;;
string appId = &quot;your-app-id&quot;;
string appSecret = &quot;your-app-secret&quot;;

using (var context = manager.GetAppOnlyAuthenticatedContext(siteUrl, appId, appSecret))
{

    var list = context.Web.Lists.GetByTitle(&quot;Documents&quot;);

    var fieldSchemaXml = @&quot;
        &lt;Field 
            ID=&#39;{61cbb965-1e04-4273-b658-eedaa662f48d}&#39; 
            Type=&#39;TargetTo&#39; 
            Name=&#39;Target_x0020_Audiences&#39; 
            StaticName=&#39;Target_x0020_Audiences&#39; 
            DisplayName=&#39;Target Audiences&#39; 
        /&gt;
    &quot;;

    var field = list.Fields.AddFieldAsXml(fieldSchemaXml, false, AddFieldOptions.AddFieldInternalNameHint);
    context.ExecuteQueryRetry();
}
</code></pre><p>To turn off Audience Targeting all you need to do is remove the field from the list.</p></div><footer class="post__footer"><div class="post__updated">Updated: <time datetime="2021-05-04T09:08">May 4, 2021</time></div><div class="post__tag"><span>Tags:</span><ul class="post__tag__list"><li><a href="https://wutek.co.uk/tags/c-sharp/" title="c-sharp">c-sharp</a></li><li><a href="https://wutek.co.uk/tags/code/" title="code">code</a></li><li><a href="https://wutek.co.uk/tags/pnp/" title="pnp">pnp</a></li><li><a href="https://wutek.co.uk/tags/powershell/" title="powershell">powershell</a></li><li><a href="https://wutek.co.uk/tags/sharepoint-online/" title="sharepoint-online">sharepoint-online</a></li></ul></div><div class="post__meta"><div class="post__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section post__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/field-in-list-not-available-in-listitem-using-managed-client-object-model/" class="invert">Field in List not available in ListItem using Managed Client Object Model</a></h2><p>If you have a field called &quot;Folder&quot; it...</p><footer class="card__footer"><time datetime="2013-01-25T15:17">January 25, 2013 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Ffield-in-list-not-available-in-listitem-using-managed-client-object-model%2F&title=Field%20in%20List%20not%20available%20in%20ListItem%20using%20Managed%20Client%20Object%20Model" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/runas-method-for-running-code-in-specific-user-spservicecontext/" class="invert">RunAs method for running code in specific user SPServiceContext</a></h2><p>You may have the need to run some...</p><footer class="card__footer"><time datetime="2011-10-25T14:07">October 25, 2011 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Frunas-method-for-running-code-in-specific-user-spservicecontext%2F&title=RunAs%20method%20for%20running%20code%20in%20specific%20user%20SPServiceContext" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/finding-the-smtp-server-address-through-code-in-sharepoint-2010/" class="invert">Finding the SMTP server address through code in SharePoint 2010</a></h2><p>If anyone knows a better way then let...</p><footer class="card__footer"><time datetime="2011-02-13T11:23">February 13, 2011 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Ffinding-the-smtp-server-address-through-code-in-sharepoint-2010%2F&title=Finding%20the%20SMTP%20server%20address%20through%20code%20in%20SharePoint%202010" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two/" class="invert">Using the BDC to populate user profiles from a SQL Server database - Part Two</a></h2><p>This is the second part of a two...</p><footer class="card__footer"><time datetime="2007-11-02T09:46">November 2, 2007 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fusing-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two%2F&title=Using%20the%20BDC%20to%20populate%20user%20profiles%20from%20a%20SQL%20Server%20database%20-%20Part%20Two" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://wutek.co.uk/">Toby Statham</a><div class="footer__copyright"><p>Powered by Publii</p></div><div class="footer__nav"><ul class="footer__nav"><li><a href="https://wutek.co.uk/" target="_self">Home</a></li><li><a href="https://wutek.co.uk/tags/" target="_self">Tags</a></li><li><a href="https://wutek.co.uk/about-me/" target="_self">About</a></li></ul></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top"><svg><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#toparrow"/></svg></svg></button></footer><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=11cb42b202c1c2462a7002b62194e351"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>