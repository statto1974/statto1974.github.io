<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Toby Statham</title>
    <link href="https://wutek.co.uk/feed.xml" rel="self" />
    <link href="https://wutek.co.uk" />
    <updated>2021-05-06T08:51:40+01:00</updated>
    <author>
        <name>Toby Statham</name>
    </author>
    <id>https://wutek.co.uk</id>

    <entry>
        <title>Terms &amp; Conditions</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/terms-and-conditions/"/>
        <id>https://wutek.co.uk/terms-and-conditions/</id>

        <updated>2021-05-06T08:51:40+01:00</updated>
            <summary>
                <![CDATA[
                    Terms and ConditionsLast updated: May 06, 2021 Please read these terms and conditions carefully before using Our Service. The words of which the initial letter&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <h1>Terms and Conditions</h1>
<p>Last updated: May 06, 2021</p>
<p>Please read these terms and conditions carefully before using Our Service.</p>
<h1>Interpretation and Definitions</h1>
<h2>Interpretation</h2>
<p>The words of which the initial letter is capitalised have meanings defined under the following conditions. The following definitions shall have the same meaning regardless of whether they appear in singular or in plural.</p>
<h2>Definitions</h2>
<p>For the purposes of these Terms and Conditions:</p>
<ul>
<li>
<p><strong>Affiliate</strong> means an entity that controls, is controlled by or is under common control with a party, where "control" means ownership of 50% or more of the shares, equity interest or other securities entitled to vote for election of directors or other managing authority.</p>
</li>
<li>
<p><strong>Country</strong> refers to: United Kingdom</p>
</li>
<li>
<p><strong>Company</strong> (referred to as either "the Company", "We", "Us" or "Our" in this Agreement) refers to Toby Statham.</p>
</li>
<li>
<p><strong>Device</strong> means any device that can access the Service such as a computer, a cellphone or a digital tablet.</p>
</li>
<li>
<p><strong>Service</strong> refers to the Website.</p>
</li>
<li>
<p><strong>Terms and Conditions</strong> (also referred as "Terms") mean these Terms and Conditions that form the entire agreement between You and the Company regarding the use of the Service. This Terms and Conditions agreement has been created with the help of the <a href="https://www.termsfeed.com/terms-conditions-generator/" target="_blank" rel="noopener">Terms and Conditions Generator</a>.</p>
</li>
<li>
<p><strong>Third-party Social Media Service</strong> means any services or content (including data, information, products or services) provided by a third-party that may be displayed, included or made available by the Service.</p>
</li>
<li>
<p><strong>Website</strong> refers to The Ramblings of Toby Statham, accessible from <a href="https://wutek.co.uk" rel="external nofollow noopener" target="_blank">https://wutek.co.uk</a></p>
</li>
<li>
<p><strong>You</strong> means the individual accessing or using the Service, or the company, or other legal entity on behalf of which such individual is accessing or using the Service, as applicable.</p>
</li>
</ul>
<h1>Acknowledgement</h1>
<p>These are the Terms and Conditions governing the use of this Service and the agreement that operates between You and the Company. These Terms and Conditions set out the rights and obligations of all users regarding the use of the Service.</p>
<p>Your access to and use of the Service is conditioned on Your acceptance of and compliance with these Terms and Conditions. These Terms and Conditions apply to all visitors, users and others who access or use the Service.</p>
<p>By accessing or using the Service You agree to be bound by these Terms and Conditions. If You disagree with any part of these Terms and Conditions then You may not access the Service.</p>
<p>You represent that you are over the age of 18. The Company does not permit those under 18 to use the Service.</p>
<p>Your access to and use of the Service is also conditioned on Your acceptance of and compliance with the Privacy Policy of the Company. Our Privacy Policy describes Our policies and procedures on the collection, use and disclosure of Your personal information when You use the Application or the Website and tells You about Your privacy rights and how the law protects You. Please read Our Privacy Policy carefully before using Our Service.</p>
<h1>Links to Other Websites</h1>
<p>Our Service may contain links to third-party web sites or services that are not owned or controlled by the Company.</p>
<p>The Company has no control over, and assumes no responsibility for, the content, privacy policies, or practices of any third party web sites or services. You further acknowledge and agree that the Company shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with the use of or reliance on any such content, goods or services available on or through any such web sites or services.</p>
<p>We strongly advise You to read the terms and conditions and privacy policies of any third-party web sites or services that You visit.</p>
<h1>Termination</h1>
<p>We may terminate or suspend Your access immediately, without prior notice or liability, for any reason whatsoever, including without limitation if You breach these Terms and Conditions.</p>
<p>Upon termination, Your right to use the Service will cease immediately.</p>
<h1>Limitation of Liability</h1>
<p>Notwithstanding any damages that You might incur, the entire liability of the Company and any of its suppliers under any provision of this Terms and Your exclusive remedy for all of the foregoing shall be limited to the amount actually paid by You through the Service or 0.01 GBP if You haven't purchased anything through the Service.</p>
<p>To the maximum extent permitted by applicable law, in no event shall the Company or its suppliers be liable for any special, incidental, indirect, or consequential damages whatsoever (including, but not limited to, damages for loss of profits, loss of data or other information, for business interruption, for personal injury, loss of privacy arising out of or in any way related to the use of or inability to use the Service, third-party software and/or third-party hardware used with the Service, or otherwise in connection with any provision of this Terms), even if the Company or any supplier has been advised of the possibility of such damages and even if the remedy fails of its essential purpose.</p>
<p> </p>
<h1>"AS IS" and "AS AVAILABLE" Disclaimer</h1>
<p>The Service is provided to You "AS IS" and "AS AVAILABLE" and with all faults and defects without warranty of any kind. To the maximum extent permitted under applicable law, the Company, on its own behalf and on behalf of its Affiliates and its and their respective licencors and service providers, expressly disclaims all warranties, whether express, implied, statutory or otherwise, with respect to the Service, including all implied warranties of merchant-ability, fitness for a particular purpose, title and non-infringement, and warranties that may arise out of course of dealing, course of performance, usage or trade practice. Without limitation to the foregoing, the Company provides no warranty or undertaking, and makes no representation of any kind that the Service will meet Your requirements, achieve any intended results, be compatible or work with any other software, applications, systems or services, operate without interruption, meet any performance or reliability standards or be error free or that any errors or defects can or will be corrected.</p>
<p>Without limiting the foregoing, neither the Company nor any of the company's provider makes any representation or warranty of any kind, express or implied: (i) as to the operation or availability of the Service, or the information, content, and materials or products included thereon; (ii) that the Service will be uninterrupted or error-free; (iii) as to the accuracy, reliability, or currency of any information or content provided through the Service; or (iv) that the Service, its servers, the content, or e-mails sent from or on behalf of the Company are free of viruses, scripts, trojan horses, worms, malware, timebombs or other harmful components.</p>
<p>Some jurisdictions do not allow the exclusion of certain types of warranties or limitations on applicable statutory rights of a consumer, so some or all of the above exclusions and limitations may not apply to You. But in such a case the exclusions and limitations set forth in this section shall be applied to the greatest extent enforceable under applicable law.</p>
<h1>Governing Law</h1>
<p>The laws of the Country, excluding its conflicts of law rules, shall govern this Terms and Your use of the Service. Your use of the Application may also be subject to other local, state, national, or international laws.</p>
<h1>Disputes Resolution</h1>
<p>If You have any concern or dispute about the Service, You agree to first try to resolve the dispute informally by contacting the Company.</p>
<h1>For European Union (EU) Users</h1>
<p>If You are a European Union consumer, you will benefit from any mandatory provisions of the law of the country in which you are resident in.</p>
<h1>United States Legal Compliance</h1>
<p>You represent and warrant that (i) You are not located in a country that is subject to the United States government embargo, or that has been designated by the United States government as a "terrorist supporting" country, and (ii) You are not listed on any United States government list of prohibited or restricted parties.</p>
<h1>Severability and Waiver</h1>
<h2>Severability</h2>
<p>If any provision of these Terms is held to be unenforceable or invalid, such provision will be changed and interpreted to accomplish the objectives of such provision to the greatest extent possible under applicable law and the remaining provisions will continue in full force and effect.</p>
<h2>Waiver</h2>
<p>Except as provided herein, the failure to exercise a right or to require performance of an obligation under this Terms shall not effect a party's ability to exercise such right or require such performance at any time thereafter nor shall be the waiver of a breach constitute a waiver of any subsequent breach.</p>
<h1>Translation Interpretation</h1>
<p>These Terms and Conditions may have been translated if We have made them available to You on our Service. You agree that the original English text shall prevail in the case of a dispute.</p>
<h1>Changes to These Terms and Conditions</h1>
<p>We reserve the right, at Our sole discretion, to modify or replace these Terms at any time. If a revision is material We will make reasonable efforts to provide at least 30 days' notice prior to any new terms taking effect. What constitutes a material change will be determined at Our sole discretion.</p>
<p>By continuing to access or use Our Service after those revisions become effective, You agree to be bound by the revised terms. If You do not agree to the new terms, in whole or in part, please stop using the website and the Service.</p>
<h1>Contact Us</h1>
<p>If you have any questions about these Terms and Conditions, You can contact us:</p>
<ul>
<li>By email: info@wutek.co.uk</li>
</ul>
            ]]>
        </content>
    </entry>
    <entry>
        <title>About Me</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/about-me/"/>
        <id>https://wutek.co.uk/about-me/</id>

        <updated>2021-05-05T11:53:18+01:00</updated>
            <summary>
                <![CDATA[
                    My name is Toby Statham and I live in Brighton An experienced Microsoft 365 / SharePoint / Power Platform / Azure Specialist, with a proven&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <figure class="post__image"><img loading="lazy"  src="https://wutek.co.uk/media/posts/41//logo.jpg" sizes="(max-width: 768px) 100vw, 768px" srcset="https://wutek.co.uk/media/posts/41//responsive/logo-xs.jpg 300w ,https://wutek.co.uk/media/posts/41//responsive/logo-sm.jpg 480w ,https://wutek.co.uk/media/posts/41//responsive/logo-md.jpg 768w"  alt="Toby &amp; ET" width="400" height="400"></figure>
<p>My name is Toby Statham and I live in Brighton</p>
<p>An experienced <strong>Microsoft 365 / SharePoint / Power Platform / Azure Specialist</strong>, with a proven track record of directing corporate collaboration and process improvement projects – typically supporting design and development of solutions to realise business objectives.</p>
<p>Key strengths include:</p>
<ul>
<li>Engaging with global business teams to gather requirements and understand processes; working with stakeholders across organisations to help understand and implement information management and governance best practices;</li>
<li>Leading all stages of solution development, including requirements definition, design, development, architecture, testing and support;</li>
<li>Migrating companies to the latest version of SharePoint and transitioning platforms into cloud with Microsoft 365 and Azure;</li>
<li>Actively involved in the Microsoft 365, Power Platform, Azure and SharePoint communities, regularly attending conferences and user groups to expand knowledge.</li>
</ul>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Enable Audience targeting using script or code</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/enable-audience-targeting-using-script-or-code/"/>
        <id>https://wutek.co.uk/enable-audience-targeting-using-script-or-code/</id>
            <category term="sharepoint-online"/>
            <category term="powershell"/>
            <category term="pnp"/>
            <category term="development"/>
            <category term="code"/>
            <category term="c-sharp"/>

        <updated>2021-05-04T09:08:44+01:00</updated>
            <summary>
                <![CDATA[
                    Currently there are no direct methods to enable Audience Targeting on a List or Library via script or code. This is currently done through the&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Currently there are no direct methods to enable <strong>Audience Targeting</strong> on a <strong>List</strong> or <strong>Library</strong> via script or code.</p>
<p>This is currently done through the List or Library Settings screen under <strong>Audience targetting</strong> settings option</p>
<p><figure class="post__image"><img loading="lazy" src="https://wutek.co.uk/media/posts/38/settings.jpg" sizes="(max-width: 768px) 100vw, 768px" srcset="https://wutek.co.uk/media/posts/38/responsive/settings-xs.jpg 300w ,https://wutek.co.uk/media/posts/38/responsive/settings-sm.jpg 480w ,https://wutek.co.uk/media/posts/38/responsive/settings-md.jpg 768w"  alt="Image description" width="990" height="200" /></figure></p>
<p>When you enable audience targeting through these settings, a field is created in the corresponding <strong>List</strong> or <strong>Library</strong> called <strong>Target Audiences</strong></p>
<p>Using the <code>Get-PnpField</code> PnP PowerShell command to get the <code>SchemaXml</code> property we can see how the field is constructed.</p>
<pre><code class="language-ps">(Get-PnPField -Identity &quot;Target Audiences&quot; -List Documents).SchemaXml</code></pre>
<p>This is the XML returned</p>
<pre><code class="language-xml">
&lt;Field 
  ID=&quot;{61cbb965-1e04-4273-b658-eedaa662f48d}&quot; 
  Type=&quot;TargetTo&quot; 
  Name=&quot;Target_x0020_Audiences&quot; 
  DisplayName=&quot;Target Audiences&quot; 
  Required=&quot;FALSE&quot; 
  SourceID=&quot;{803a362c-54fb-47c7-83c8-e7a83a9512f8}&quot; 
  StaticName=&quot;Target_x0020_Audiences&quot; 
  ColName=&quot;ntext2&quot; 
  RowOrdinal=&quot;0&quot; Version=&quot;2&quot;&gt;
  &lt;Customization&gt;
    &lt;ArrayOfProperty&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowGlobalAudience&lt;/Name&gt;
        &lt;Value xmlns:q1=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q1:bo
olean&quot; xmlns:p4=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowDL&lt;/Name&gt;
        &lt;Value xmlns:q2=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q2:boolean&quot; xmlns:p4=&quot;http://www.w
3.org/2001/XMLSchema-instance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
      &lt;Property&gt;
        &lt;Name&gt;AllowSPGroup&lt;/Name&gt;
        &lt;Value xmlns:q3=&quot;http://www.w3.org/2001/XMLSchema&quot; p4:type=&quot;q3:boolean&quot; xmlns:p4=&quot;http://www.w3.org/2001/XMLSchema-ins
tance&quot;&gt;true&lt;/Value&gt;
      &lt;/Property&gt;
    &lt;/ArrayOfProperty&gt;
  &lt;/Customization&gt;
&lt;/Field&gt;</code></pre>
<p>After some experimenting, I found that the only two columns you need to set are the <code>ID</code> and <code>Type</code></p>
<blockquote>
<p><code>ID</code> needs to have <strong>61cbb965-1e04-4273-b658-eedaa662f48d</strong> set as it’s value</p>
<p><code>Type</code> needs to have <strong>TargetTo</strong> set as it’s value</p>
</blockquote>
<p>You still need to provide values for <code>Name</code>, <code>DisplayName</code>, <code>StaticName</code>, but they can be whatever you want.</p>
<p>Don’t like the name <strong>Target Audiences</strong> then you can change it to something else. The great thing is, it can still be turned off through the List or Library settings page.</p>
<p>To enable Audinence targeting using PnP PowerShell it’s as simple as running this script.</p>
<pre><code class="language-ps">
$credentials = (Get-Credential)

Connect-PnPOnline -Url https://contoso.sharepoint.com/sites/somesite -Credentials $credentials

Add-PnPFieldFromXml &#39;&lt;Field ID=&quot;{61cbb965-1e04-4273-b658-eedaa662f48d}&quot; Type=&quot;TargetTo&quot; Name=&quot;Target_x0020_Audiences&quot; StaticName=&quot;Target_x0020_Audiences&quot; DisplayName=&quot;Target Audiences&quot; /&gt;&#39; -List Documents</code></pre>
<p>And to do the same thing in C# CSOM</p>
<pre><code class="language-cs">
// from SharePointPnPCoreOnline Nuget package
var manager = new OfficeDevPnP.Core.AuthenticationManager();

string siteUrl = &quot;https://contoso.sharepoint.com/sites/somesite&quot;;
string appId = &quot;your-app-id&quot;;
string appSecret = &quot;your-app-secret&quot;;

using (var context = manager.GetAppOnlyAuthenticatedContext(siteUrl, appId, appSecret))
{

    var list = context.Web.Lists.GetByTitle(&quot;Documents&quot;);

    var fieldSchemaXml = @&quot;
        &lt;Field 
            ID=&#39;{61cbb965-1e04-4273-b658-eedaa662f48d}&#39; 
            Type=&#39;TargetTo&#39; 
            Name=&#39;Target_x0020_Audiences&#39; 
            StaticName=&#39;Target_x0020_Audiences&#39; 
            DisplayName=&#39;Target Audiences&#39; 
        /&gt;
    &quot;;

    var field = list.Fields.AddFieldAsXml(fieldSchemaXml, false, AddFieldOptions.AddFieldInternalNameHint);
    context.ExecuteQueryRetry();
}
</code></pre>
<p>To turn off Audience Targeting all you need to do is remove the field from the list.</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Showing a ListView CommandSet if a user is in a SharePoint Group</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/showing-a-listview-commandset-if-a-user-is-in-a-sharepoint-group/"/>
        <id>https://wutek.co.uk/showing-a-listview-commandset-if-a-user-is-in-a-sharepoint-group/</id>
            <category term="typescript"/>
            <category term="spfx"/>
            <category term="sharepoint-online"/>
            <category term="extensions"/>
            <category term="development"/>
            <category term="code"/>

        <updated>2021-05-04T09:30:26+01:00</updated>
            <summary>
                <![CDATA[
                    This post is about creating a ListView CommandSet extension which uses the the onInit method to make “service” calls. If you want to dive straight&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>This post is about creating a ListView CommandSet extension which uses the the <code>onInit</code> method to make “service” calls.</p>
<blockquote>
<p>If you want to dive straight in, the source code for this post is available from <a href="https://github.com/statto1974/my-command-set">my-command-set GitHub repository</a>.   </p>
</blockquote>
<blockquote>
<p>Full details can be found on creating an <strong>Extension</strong> solution can be found on the <a href="https://docs.microsoft.com/en-us/sharepoint/dev/spfx/extensions/get-started/building-simple-cmdset-with-dialog-api">SharePoint Framework Extension Documentation Site</a>, but I’ve given a whistle stop tour below.</p>
</blockquote>
<h2 id="creating-an-extension-project">Creating an Extension project</h2>
<p>This is done using the Yeoman SharePoint Generator in a terminal of your choice.   </p>
<pre><code>md my-command-set
cd app-extension
yo @microsoft/sharepoint</code></pre><p>Enter the following options</p>
<pre><code>? What is your solution name? my-command-set
? Which baseline packages... ? SharePoint Online only (latest)
? Where do you ... files? Use the current folder
? Do you want ... tenant admin ... in sites? No
? Will the components ... APIs ... tenant? No
? Which type of client-side component to create? Extension
? Which type of client-side extension to create? ListView Command Set
Add new Command Set to solution my-command-set.
? What is your Command Set name? SecurableCommandSet
? What is your Command Set description? SecurableCommandSet description</code></pre><p>Wait for Yeoman to do it’s thing…</p>
<p>And then wait a little longer…</p>
<p>I use <a href="https://code.visualstudio.com/">Visual Studio Code</a> so if you’re joining me on this journey…</p>
<pre><code>code .</code></pre><p>Hopefully you’ll see these files in your repo</p>
<p>{% asset_img “prj-files.jpg” “Project Files” %}  </p>
<p>First of all lets setup the CommandSet in the manifest.</p>
<ul>
<li>Navigate to <strong>src\extensions\securableCommandSet</strong> folder</li>
<li>Open the <strong>SecurableCommandSetCommandSet.manifest.json</strong> file</li>
</ul>
<h2 id="updating-the-project-files">Updating the project files</h2>
<p>Remove the two commands that were created with the project</p>
<pre><code class="language-js">&quot;items&quot;: {
  &quot;COMMAND_1&quot;: {
    &quot;title&quot;: { &quot;default&quot;: &quot;Command One&quot; },
    &quot;iconImageUrl&quot;: &quot;icons/request.png&quot;,
    &quot;type&quot;: &quot;command&quot;
  },
  &quot;COMMAND_2&quot;: {
    &quot;title&quot;: { &quot;default&quot;: &quot;Command Two&quot; },
    &quot;iconImageUrl&quot;: &quot;icons/cancel.png&quot;,
    &quot;type&quot;: &quot;command&quot;
  }
}</code></pre>
<p>Replace them with the command that’s going to be secured</p>
<pre><code class="language-js">&quot;items&quot;: {
  &quot;CMD_SECURE&quot;: {
    &quot;title&quot;: { &quot;default&quot;: &quot;Secret Command&quot; },
    &quot;iconImageUrl&quot;: &quot;data:image...&quot;,
    &quot;type&quot;: &quot;command&quot;
  }
}</code></pre>
<p><em>Full base64-encoded image is included with source code</em></p>
<p>Next open up <strong>SecurableCommandSetCommandSet.ts</strong></p>
<p>Add a private field to the classe to store the visibility of the command.</p>
<pre><code class="language-ts">private isInOwnersGroup: boolean = false;</code></pre>
<p>We want to make sure the command is only visible to people who are in the Owners group of the site we are in. </p>
<p>This is done in the <code>onListViewUpdated</code> method of the <code>SecurableCommandSetCommandSet</code> class.</p>
<p>Below is the code added when the project is created.</p>
<pre><code class="language-ts">@override
public onListViewUpdated(event: IListViewCommandSetListViewUpdatedParameters): void {
  const compareOneCommand: Command = this.tryGetCommand(&#39;COMMAND_1&#39;);
  if (compareOneCommand) {
    // This command should be hidden unless exactly one row is selected.
    compareOneCommand.visible = event.selectedRows.length === 1;
  }
}</code></pre>
<p>Replace it with following</p>
<pre><code class="language-ts">@override
public onListViewUpdated(event: IListViewCommandSetListViewUpdatedParameters): void {
  const compareSecureCommand: Command = this.tryGetCommand(&#39;CMD_SECURE&#39;);
  if (compareSecureCommand) {

    compareSecureCommand.visible = this.isInOwnersGroup;
  }

}</code></pre>
<p>Install the PnP client side libraries as we’re going to need some of their magic in this solution</p>
<pre><code>npm i @pnp/sp @pnp/common @pnp/logging @pnp/odata --save</code></pre><p>SharePoint Groups and their members aren’t available in the <code>BaseListViewCommandSet.context</code> property, so we’re going to need to load them.</p>
<p>The problem is that this will have to be done using Promises and <code>onListViewUpdated</code> doesn’t return a promise.</p>
<p>Luckily we have the <code>onInit</code> method for this (returns <code>Promise&lt;void&gt;</code>). This method gets called when you component is initialised (Basically when the list view is loaded up in the page). Anything in the <code>onInit</code> method will run before the commands are rendered, similar to the actions you’d run in the <code>componentWillMount</code> method of a react component.</p>
<p>To use the pnpjs library it needs to be initialised first and this needs to be done in the <code>onInit</code> method.</p>
<p>Add the import statement</p>
<pre><code class="language-ts">import { sp } from &quot;@pnp/sp&quot;;</code></pre>
<p>Replace the <code>onInit</code> method with the following code, this sets up the <code>sp</code> helper with context of the Extension and then to call into the SharePoint Groups in the site, we’re going to have to await away in the <code>onInit</code> method again to call into the site and set the <code>isInOwnersGroup</code> field.</p>
<pre><code class="language-ts">@override
public async onInit(): Promise&lt;void&gt; {

  await super.onInit();

  await sp.setup({ spfxContext: this.context });

  const email: string = this.context.pageContext.user.email;
  const ownerGroup: SiteGroup = sp.web.associatedOwnerGroup;
  const users: SPUser[] = await ownerGroup.users.get();

  this.isInOwnersGroup = users.some((user: any) =&gt; user.Email === email);

  return Promise.resolve&lt;void&gt;();
}</code></pre>
<blockquote>
<p>For the observant people out there, you may notice that I’ve declared <code>user</code> as <code>any</code>. For some reason, the users collection returned has UpperCamelCase properties and the TypeScript reference is using lowerCamelCase, which was causing a TypeScript compile error. Hence the <code>user.Email === email</code> rather than <code>user.email === email</code> in the <code>some</code> function call.</p>
</blockquote>
<p>In this snippet of code, we’re getting the login of the current user, the associated owner group of the site and then getting the users in the group.</p>
<p>The <code>some</code> function determines if the user is in the group and it’s result sets the <code>isInOwnersGroup</code>.</p>
<p>Finally an update is needed on the <code>onListViewUpdated</code> method to show / hide the command.</p>
<pre><code class="language-ts">const compareSecureCommand: Command = this.tryGetCommand(&#39;CMD_SECURE&#39;);

if (compareSecureCommand) {

  compareSecureCommand.visible = this.isInOwnersGroup;
}</code></pre>
<p>Add the new command to the <code>onExecute</code> method to make sure it gets picked up in the <code>switch</code> statement</p>
<pre><code class="language-ts">switch (event.itemId) {
  case &#39;CMD_SECURE&#39;:
    Dialog.alert(&quot;Shhhhhh! It&#39;s a secret...&quot;);
    break;
  default:
    throw new Error(&#39;Unknown command&#39;);
}
</code></pre>
<p>Now we’re ready to <code>gulp serve</code></p>
<p>Open up <strong>serve.json</strong> in the <strong>config</strong> directory</p>
<p>Change the two pageUrl properties to a list in your tenant</p>
<pre><code class="language-js">&quot;pageUrl&quot;: &quot;https://contoso.sharepoint.com/sites/mySite/SitePages/myPage.aspx&quot;</code></pre>
<blockquote>
<p>Currently there is a bug in tenants that are on First Release that stops <code>gulp serve</code> working correctly. If you can’t see your command then switch to Standard (not always instant!), if it still doesn’t work then try deploying without the <code>--ship</code> paramter. See all the details on the <a href="https://github.com/SharePoint/sp-dev-docs/issues/3914#issuecomment-508123159">sp-dev-docs GitHub repository</a></p>
</blockquote>
<p>Make sure you account is in the Owners group (It won’t be if you created a “groupified” team site).</p>
<p>If all is good your new CommandSet should appear on the top menu and will show the alert message when clicked.</p>
<p>![“Command Set menu”](</p>
<p>{% asset_img “cmdset.jpg” “Command Set menu” %}</p>
<p>{% asset_img “dialog.jpg” “Dialog” %}</p>
<h2 id="summary">Summary</h2>
<p>Getting the SharePoint group users is just an example of how you can use the <code>onInit</code> method to call into other services, like custom web apis, MS Graph, etc.</p>
<p>Remember that this could effect the load time of your command, which may effect the user experience. The context menu may not be on screen for long, so your menu may have not loaded before it’s gone.</p>
<h2 id="useful-links">Useful Links</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/sharepoint/dev/spfx/extensions/get-started/building-simple-cmdset-with-dialog-api">Build your first ListView Command Set extension</a></li>
<li><a href="https://www.base64-image.de/">Convert your images to base64</a></li>
</ul>

            ]]>
        </content>
    </entry>
    <entry>
        <title>PowerPivot Management Dashboard: Error with &quot;Infrastructure - Server Health&quot; report</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/powerpivot-management-dashboard-error-with-infrastructure-server-health-report/"/>
        <id>https://wutek.co.uk/powerpivot-management-dashboard-error-with-infrastructure-server-health-report/</id>
            <category term="powershell"/>
            <category term="PowerPivot"/>

        <updated>2021-05-04T08:35:19+01:00</updated>
            <summary>
                <![CDATA[
                    When loading this page in Central Administration, I was being presented with a Excel Services error and a correlation ID. Looking at the ULS logs&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>When loading this page in Central Administration, I was being presented with a Excel Services error and a correlation ID.</p>
<p>Looking at the ULS logs I noticed the following error.</p>
<p><em>Insufficient SQL database permissions for user 'Name: &lt;DOMAIN\USERNAME&gt; SID: &lt;SID-CODE&gt; ImpersonationLevel: None' in database '&lt;DATABASE-NAME&gt;' on SQL Server instance '&lt;SQL-INSTANCE&gt;'. Additional error information from SQL Server is included below.  The EXECUTE permission was denied on the object 'proc_ReturnWebFeatures', database '&lt;DATABASE-NAME&gt;', schema 'dbo'. 1d0d479c-5a36-c0dc-912b-5bc267b09a0a</em></p>
<p>The database name was referring to the Content Admin database of Central Administration and the user name was referring to the service application account that the PowerPivot service application had been configured to run under.</p>
<p>The proc_ReturnWebFeatures stored procedure required the user to be a member of the SPDataAccess role to allow EXECUTE permissions. The service application user was only in the WSS_Content_Application_Pools role.</p>
<p>If you run the following script, this will grant the correct rights in the database</p>
<p>$url = "<a href="http://centraladminsite:2013">http://centraladminsite:2013</a>"<br />
$webApp = Get-SPWebApplication -Identity $url<br />
$webApp.GrantAccessToProcessIdentity("DOMAIN\serviceapplicationuser")</p>
<p>Now when you load up the PowerPivot Management Dashboard, you report should be displayed.</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Adding Metadata navigation and per-location setting programmatically to a list</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/adding-metadata-navigation-and-per-location-setting-programmatically-to-a-list/"/>
        <id>https://wutek.co.uk/adding-metadata-navigation-and-per-location-setting-programmatically-to-a-list/</id>
            <category term="Taxonomy"/>
            <category term="SharePoint2010"/>
            <category term="Metadata"/>

        <updated>2021-05-04T10:38:00+01:00</updated>
            <summary>
                <![CDATA[
                    This turned out to be harder than I thought. Metadata navigation and per-location views are an little known, but powerful way of making lists more&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>This turned out to be harder than I thought.</p>
<p>Metadata navigation and per-location views are an  little known, but powerful way of making lists more useful.</p>
<p>It allows you to assign a default view and others views to a folder, content type or field. My need was to allow users to navigate using a Taxonomy field. Dependent on the selected field, I would like to show different fields using a view.</p>
<p>The first part is to add the Metadata navigation.</p>
<p>This is done by creating a hierarchy using MetadataNavigationHierarchy</p>
<pre><code class="language-csharp">
  var list = SPContext.Current.Web.Lists.TryGetList("MyList");
  var field = list.Fields.TryGetFieldByStaticName("MyField");
  var settings = MetadataNavigationSettings.GetMetadataNavigationSettings(list);
  var hierarchy = settings.FindConfiguredHierarchy(field.Id);

  if (hierarchy == null)
  {
  	hierarchy = new MetadataNavigationHierarchy(field);
  	settings.AddConfiguredHierarchy(hierarchy);
  }
  MetadataNavigationSettings.SetMetadataNavigationSettings(list, settings);
</code></pre>
<p>The hard part is adding the settings for the per location views.</p>
<p>This can only be done by injecting XML into the settings XML. MetadataNavigationSettings is a wrapper class around an XML snippet that is stored in a hidden property of the root folder of the list.</p>
<p>Have a look at SPList.RootFolder.Properties["client_MOSS_MetadataNavigationSettings"]</p>
<p>The XML Schema is as follows. Haven't found anything documenting this schema on MSDN yet, so this is just taken from my configuration of my list, so may differ on yours</p>
<pre><code class="language-markup">
&lt;MetadataNavigationSettings SchemaVersion="1" IsEnabled="True"
AutoIndex="True"&gt;
&lt;NavigationHierarchies&gt;
&lt;FolderHierarchy HideFoldersNode="True" /&gt;
&lt;MetadataField FieldID="a96cea49-ef78-4bfa-8a69-2c49071155fb"
FieldType="TaxonomyFieldType"
CachedName="Legal_x0020_Document_x0020_Category"
CachedDisplayName="Legal Document Category"&gt;
&lt;ViewSettings UniqueNodeId="eadcb112-33af-4700-ad11-8e6afbd800e6"&gt;
&lt;View ViewId="4f4d05f4-046f-4bfa-a37c-170847fd4e34"
CachedName="My Custom View" Index="0"
CachedUrl="Store/Forms/My Custom View.aspx" /&gt;
&lt;View ViewId="a1ab958f-40d5-4e4a-ac3f-a10bc3cd22d2"
CachedName="My Other Custom View" Index="1"
CachedUrl="Store/Forms/AllItems.aspx" /&gt;
&lt;View ViewId="5c9447a3-ff59-419a-92b1-c7f0191d6f82"
CachedName="Not visisible view" Index="-1"
CachedUrl="Store/Forms/Not visisible view.aspx" /&gt;
&lt;/ViewSettings&gt;
&lt;/MetadataField&gt;
&lt;/NavigationHierarchies&gt;
&lt;KeyFilters /&gt;
&lt;ManagedIndices&gt;
&lt;ManagedIndex IndexID="a96cea49-ef78-4bfa-8a69-2c49071155fb"
IndexFieldName="Legal_x0020_Document_x0020_Category"
IndexFieldID="a96cea49-ef78-4bfa-8a69-2c49071155fb" /&gt;
&lt;/ManagedIndices&gt;
&lt;ViewSettings UniqueNodeId=""&gt;
&lt;View ViewId="a1ab958f-40d5-4e4a-ac3f-a10bc3cd22d2"
CachedName="All Documents" Index="0"
CachedUrl="Store/Forms/AllItems.aspx" /&gt;
&lt;/ViewSettings&gt;
&lt;/MetadataNavigationSettings&gt;
</code></pre>
<p>The part I'm interested in here is the ViewSettings and View tag. The UniqueId attribute relates to the GUID of the selected Term GUID. So this will show the views defined using the View tag when the Term is selected in the Metadata navigation.</p>
<p>If a View tag is added with 0 index this will be used as the default view when the term is selected, all other positive numbers will be shown in the order defined as other available views for that Term. Any negatives will not be available (You don't need to add them)</p>
<p>I used the following code to add these nodes programmaticallty using XLinq</p>
<p><code class="language-csharp"><br>
var list = SPContext.Current.Web.Lists.TryGetList("MyList");<br>
var view = list.Views.Cast().SingleOrDefault(v =&gt; v.Title == "MyView");<br>
var session = new TaxonomySession(SPContext.Current.Site);<br>
var field = list.Fields.TryGetFieldByStaticName("MyField");<br>
var term = session.GetTerm("a96cea49-ef78-4bfa-8a69-2c49071155fb");<br>
var settings = MetadataNavigationSettings.GetMetadataNavigationSettings(list);<br>
var doc = XDocument.Parse(settings.SettingsXml);<br>
var metaDataField = (from f in doc.Descendants("MetadataField")<br>
let fieldId = f.Attribute("FieldID")<br>
where fieldId != null &amp;&amp; fieldId.Value == field.Id.ToString()<br>
select f).SingleOrDefault();<br>
if (metaDataField != null)<br>
{<br>  var viewSettings = (from v in metaDataField.Elements("ViewSettings")<br>  let uniqueNodeId = v.Attribute("UniqueNodeId")<br>    where uniqueNodeId != null &amp;&amp; uniqueNodeId.Value == term.Id.ToString()<br>    select v).SingleOrDefault();<br>  if (viewSettings == null)<br>  {<br>
metaDataField.Add(<br>
new XElement("ViewSettings",<br>
new XAttribute("UniqueNodeId", term.Id.ToString()),<br>
new XElement("View",<br>
new XAttribute("ViewId", view.ID.ToString()),<br>
new XAttribute("CachedName", view.Title),<br>
new XAttribute("Index", "0"),<br>
new XAttribute("CachedUrl", view.Url)<br>
)<br>
)<br>
);<br>
}<br>
}<br>
settings = new MetadataNavigationSettings(doc.ToString());<br>
MetadataNavigationSettings.SetMetadataNavigationSettings(list, settings);<br>
</code></p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Updating the Version property of a field to the Version attribute in the fields SchemaXml</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/updating-the-version-property-of-a-field-to-the-version-attribute-in-the-fields-schemaxml/"/>
        <id>https://wutek.co.uk/updating-the-version-property-of-a-field-to-the-version-attribute-in-the-fields-schemaxml/</id>
            <category term="never"/>
            <category term="hack"/>
            <category term="database"/>
            <category term="SharePoint"/>

        <updated>2021-05-04T08:35:19+01:00</updated>
            <summary>
                <![CDATA[
                    THIS IS VERY BAD. WE ALL KNOW THAT MAKING DIRECT UPDATES TO THE DATABASE WILL CREATE SOME SORT OF BLACK HOLE AND KITTENS DIE IN&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p><strong><span style="color:#ff6600;">THIS IS VERY BAD. WE ALL KNOW THAT MAKING DIRECT UPDATES TO THE DATABASE WILL CREATE SOME SORT OF BLACK HOLE AND KITTENS DIE IN REDMOND ETC, ETC. I HAVEN'T TESTED THE LONG TERM EFFECTS AND ONLY DID THIS ON MY DEVELOPMENT ENVIRONMENT TO GET ME OUT OF A PICKLE.</span></strong></p>
<p>Disclaimer over.</p>
<p>If you ever get this error when trying to update a field, either through the web UI or programmatic-ally  it normally means your Version fields are out of sync. This can occur if your field has been created using the Schema XML from another environment or you have migrated content using some dodgy 3rd party app.</p>
<p>Run this update on your content databases and you all should be good again.<br />
<code><br />
UPDATE [MyContentDatabase].[dbo].[ContentTypes]<br />
SET [Version] = CAST([Definition] AS XML).value('(/Field/@Version)[1]', 'int')<br />
WHERE CAST([Definition] AS XML).value('(/Field/@Version)[1]', 'int') &lt;&gt; [Version]<br />
</code></p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Traversing Taxonomy Terms from branch to leaf</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/traversing-taxonomy-terms-from-branch-to-leaf/"/>
        <id>https://wutek.co.uk/traversing-taxonomy-terms-from-branch-to-leaf/</id>
            <category term="terms"/>
            <category term="sharepoint 2013"/>
            <category term="client components"/>

        <updated>2021-05-04T08:35:19+01:00</updated>
            <summary>
                <![CDATA[
                    I had a need to show the path of terms, starting from a specific term and then showing the path to the final children, This&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I had a need to show the path of terms, starting from a specific term and then showing the path to the final children,</p>
<p>This would involve traversing the structure as the depth is unknown, so I wrote this piece of code to accomplish this using the Client Components.</p>
<p>Please feel free to steal and improve (Only if you give back the improved code though!)</p>
<p>private <span style="color:#99ccff;">IEnumerable</span>&lt;<span style="color:#99ccff;">Path</span>&gt; Paths(<span style="color:#3366ff;">bool</span> includeRoot, <span style="color:#99ccff;">Guid</span> termId, <span style="color:#3366ff;">string</span> siteUrl)<br />
{<br />
<span style="color:#3366ff;">var</span> paths = <span style="color:#3366ff;">new</span> List&lt;Path&gt;();<br />
Action&lt;ClientContext, Term, String&gt; traverse = <span style="color:#3366ff;">null</span>;</p>
<p>traverse = (context, term, path) =&gt;<br />
{<br />
context.Load(term, t =&gt; t.Id, t =&gt; t.Name, t =&gt; t.Terms);<br />
context.ExecuteQuery();</p>
<p><span style="color:#3366ff;">if</span> (!(term.Id == termId &amp;&amp; !includeRoot))<br />
path += path == <span style="color:#3366ff;">string</span>.Empty ? term.Name : <span style="color:#993300;">" &gt; {0}"</span>.ToFormat(term.Name);</p>
<p>if (term.Terms.Count == 0)<br />
{<br />
paths.Add(<span style="color:#3366ff;">new</span> <span style="color:#99ccff;">Path</span><br />
{<br />
TermId = term.Id,<br />
PathText = path<br />
});<br />
}<br />
<span style="color:#3366ff;">else</span><br />
{<br />
<span style="color:#3366ff;">foreach</span> (<span style="color:#3366ff;">var</span> st <span style="color:#3366ff;">in</span> term.Terms)<br />
{<br />
traverse(context, st, path);<br />
}<br />
}<br />
};</p>
<p><span style="color:#3366ff;">using</span> (<span style="color:#3366ff;">var</span> context = <span style="color:#3366ff;">new</span> <span style="color:#99ccff;">ClientContext</span>(siteUrl))<br />
{<br />
var rootTerm = <span style="color:#99ccff;">TaxonomySession</span>.GetTaxonomySession(context).GetTerm(termId);</p>
<p>traverse(context, rootTerm, <span style="color:#3366ff;">string</span>.Empty);<br />
}</p>
<p><span style="color:#3366ff;">return</span> paths;<br />
}</p>
<p><span style="color:#3366ff;">public class</span> <span style="color:#00ccff;">Path</span><br />
{<br />
<span style="color:#3366ff;">public</span> <span style="color:#00ccff;">Guid</span> TermId { <span style="color:#3366ff;">get</span>; <span style="color:#3366ff;">set</span>; }<br />
<span style="color:#3366ff;">public</span> <span style="color:#3366ff;">string</span> PathText { <span style="color:#3366ff;">get</span>; <span style="color:#3366ff;">set</span>; }<br />
}</p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>Field in List not available in ListItem using Managed Client Object Model</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/field-in-list-not-available-in-listitem-using-managed-client-object-model/"/>
        <id>https://wutek.co.uk/field-in-list-not-available-in-listitem-using-managed-client-object-model/</id>
            <category term="client components"/>

        <updated>2021-05-04T08:35:19+01:00</updated>
            <summary>
                <![CDATA[
                    If you have a field called "Folder" it will not be available in the returned ListItem object e.g. listItem["Folder"].ToString() The inner workings of the ListItem&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>If you have a field called "Folder" it will not be available in the returned ListItem object</p>
<p>e.g. listItem["Folder"].ToString()</p>
<p>The inner workings of the ListItem object uses an ExpandoObject to store the properties. It seems it mixes this up in the FieldValues Collection with all your custom fields. The Folder property then takes the value from the FieldValues collection to make it available to the Folder property. Thus making your own Folder field "disappear"</p>
<p>Here is how you can replicate it.</p>
<ul>
<li>Create a list based on the Custom List template</li>
<li>Add a column called "Folder" and make it a text field</li>
<li>Add a column called "DisplayName" and make it a text field</li>
<li>Add a column called "MyField" and make it a text field</li>
</ul>
<p>Add a couple of dummy rows of data</p>
<p>Create a console application in VS that references Microsoft.SharePoint.Client and Microsoft.SharePoint.Client.Runtime</p>
<p>Add the following code to the Main method</p>
<pre>using (var context = new ClientContext("http://siteurl"))
{
  var query = CamlQuery.CreateAllItemsQuery();
  var listItems = context.Web.Lists.GetByTitle("Testing").GetItems(query);

  context.Load(listItems);
  context.ExecuteQuery();

  foreach (var listItem in listItems)
  {
    Console.WriteLine("Title: {0}", listItem["Title"]);
    Console.WriteLine("Folder: {0}", listItem["Folder"]);
    Console.WriteLine("DisplayName: {0}", listItem["DisplayName"]);
    Console.WriteLine("MyField: {0}", listItem["MyField"]);
  }
}</pre>
<p>Here is the code from .Net Reflector that shows the ListItem object populating the properties. It's also worth noting that the other properties detailed in this method will have the same problem, but it's unlikely that you'll call a field FileSystemObject!</p>
<pre>protected override bool InitOnePropertyFromJson(string peekedName, JsonReader reader)
    {
        bool flag = base.InitOnePropertyFromJson(peekedName, reader);
        if (!flag)
        {
            switch (peekedName)
            {
                case "AttachmentFiles":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("AttachmentFiles", this.AttachmentFiles, reader);
                    this.AttachmentFiles.FromJson(reader);
                    return flag;

                case "ContentType":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("ContentType", this.ContentType, reader);
                    this.ContentType.FromJson(reader);
                    return flag;

                case "DisplayName":
                    flag = true;
                    reader.ReadName();
                    base.ObjectData.Properties["DisplayName"] = reader.ReadString();
                    return flag;

                case "EffectiveBasePermissions":
                    flag = true;
                    reader.ReadName();
                    base.ObjectData.Properties["EffectiveBasePermissions"] = reader.Read&lt;BasePermissions&gt;();
                    return flag;

                case "EffectiveBasePermissionsForUI":
                    flag = true;
                    reader.ReadName();
                    base.ObjectData.Properties["EffectiveBasePermissionsForUI"] = reader.Read&lt;BasePermissions&gt;();
                    return flag;

                case "FieldValuesAsHtml":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("FieldValuesAsHtml", this.FieldValuesAsHtml, reader);
                    this.FieldValuesAsHtml.FromJson(reader);
                    return flag;

                case "FieldValuesAsText":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("FieldValuesAsText", this.FieldValuesAsText, reader);
                    this.FieldValuesAsText.FromJson(reader);
                    return flag;

                case "FieldValuesForEdit":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("FieldValuesForEdit", this.FieldValuesForEdit, reader);
                    this.FieldValuesForEdit.FromJson(reader);
                    return flag;

                case "File":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("File", this.File, reader);
                    this.File.FromJson(reader);
                    return flag;

                case "FileSystemObjectType":
                    flag = true;
                    reader.ReadName();
                    base.ObjectData.Properties["FileSystemObjectType"] = reader.ReadEnum&lt;FileSystemObjectType&gt;();
                    return flag;

                case "Folder":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("Folder", this.Folder, reader);
                    this.Folder.FromJson(reader);
                    return flag;

                case "Id":
                    flag = true;
                    reader.ReadName();
                    base.ObjectData.Properties["Id"] = reader.ReadInt32();
                    return flag;

                case "ParentList":
                    flag = true;
                    reader.ReadName();
                    base.UpdateClientObjectPropertyType("ParentList", this.ParentList, reader);
                    this.ParentList.FromJson(reader);
                    return flag;
            }
        }
        return flag;
    }</pre>
<p>Here's a <a href="http://social.technet.microsoft.com/Forums/en-US/sharepointdevelopment/thread/275af5b9-eafa-4210-b7de-7e8a9f0cf88f">link in TechNet Forums to the initial discussion</a> and a <a href="http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/076dcf40-ec57-42ed-9232-1224a0fd5e26/">link to the reported bug</a></p>

            ]]>
        </content>
    </entry>
    <entry>
        <title>The tale of two ampersands in a Taxonomy term</title>
        <author>
            <name>Toby Statham</name>
        </author>
        <link href="https://wutek.co.uk/the-tale-of-two-ampersands-in-a-taxonomy-term/"/>
        <id>https://wutek.co.uk/the-tale-of-two-ampersands-in-a-taxonomy-term/</id>
            <category term="sharepoint 2013"/>
            <category term="client components"/>

        <updated>2021-05-04T08:35:19+01:00</updated>
            <summary>
                <![CDATA[
                    There are two types of ampersands that you need to be aware of when playing with SharePoint Taxonomy Our favorite and most loved And the impostor After&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>There are two types of ampersands that you need to be aware of when playing with SharePoint Taxonomy</p>
<p>Our favorite and most loved</p>
<h1>&amp; ASCII Number: 38</h1>
<p>And the impostor</p>
<h1>＆ ASCII Number: 65286</h1>
<p>After reading <a title="this article" href="http://nickhobbs.wordpress.com/2012/03/29/sharepoint-2010-managed-metadata-converts-ampersand-and-double-quotes-to-unicode/" target="_blank">this article</a> by <a title="Nick Hobbs" href="http://nickhobbs.wordpress.com/" target="_blank">Nick Hobbs</a>, it became apparent that when you create a term it replaces the 38 ampersand with a 65286 ampersand.</p>
<p>This then becomes a problem if you want to do a comparison with your original source (spreadsheet, database, etc) as they are no longer the same.</p>
<p>As detailed in Nick's article, you can use the TaxonomyItem.NormalizeName method to create a "Taxonomy" version of your string for comparison.</p>
<p>Below is the code I used in the SharePoint 2013 Client Component which is a little different from the server code.</p>
<p><span style="color:#3366ff;">string</span> myString =<span style="color:#993300;"> "This contains &amp;"</span>;<br />
<span style="color:#3366ff;">using</span> (var context = new ClientContext(<span style="color:#993300;">"http://myurl"</span>))<br />
{<br />
<span style="color:#3366ff;">var</span> result = <span style="color:#33cccc;">TaxonomyItem</span>.NormalizeName(context, myString);<br />
context.ExecuteQuery();</p>
<p><span style="color:#3366ff;">string</span> normalisedString = result.Value;<br />
}</p>

            ]]>
        </content>
    </entry>
</feed>
