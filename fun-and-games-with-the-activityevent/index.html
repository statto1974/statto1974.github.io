<!DOCTYPE html><html lang="en-gb" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fun and games with the ActivityEvent - Toby Statham</title><meta name="description" content="I haven't seen a massive amount of documentation on MSDN or other posts about this, so I thought I would write a small note. This details a way of extracting the info you see in the news feed on your 'My Site' First of all you need to get the&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/fun-and-games-with-the-activityevent/"><meta property="og:title" content="Fun and games with the ActivityEvent"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="I haven't seen a massive amount of documentation on MSDN or other posts about this, so I thought I would write a small note. This details a way of extracting the info you see in the news feed on your 'My Site' First of all you need to get the&hellip;"><meta property="og:url" content="https://wutek.co.uk/fun-and-games-with-the-activityevent/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Fun and games with the ActivityEvent"><meta name="twitter:description" content="I haven't seen a massive amount of documentation on MSDN or other posts about this, so I thought I would write a small note. This details a way of extracting the info you see in the news feed on your 'My Site' First of all you need to get the&hellip;"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root {
               --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
               --heading-font: 'Playfair Display', serif;
               --logo-font: var(--body-font);
               --menu-font: var(--heading-font);
            }</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=076b19ff0048426f36c3ff3f27f97211"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/fun-and-games-with-the-activityevent/"},"headline":"Fun and games with the ActivityEvent","datePublished":"2011-03-14T20:11","dateModified":"2021-05-04T08:35","description":"I haven't seen a massive amount of documentation on MSDN or other posts about this, so I thought I would write a small note. This details a way of extracting the info you see in the news feed on your 'My Site' First of all you need to get the&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="header" id="js-header"><div><a class="logo" href="https://wutek.co.uk/">Toby Statham</a><div class="search"><div class="search__overlay js-search-overlay"><form action="https://wutek.co.uk/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="Search articles..." aria-label="Search input" autofocus="autofocus"> <button class="search__submit" aria-label="Search">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div></div></header><main><article class="post"><header class="post__inner post__header--centered"><h1 class="h0 post__title">Fun and games with the ActivityEvent</h1><div class="post__meta"><div class="post__meta__author"><div><a href="https://wutek.co.uk/authors/toby-statham/" class="post__author">Toby Statham</a> <time datetime="2011-03-14T20:11" class="post__date">March 14, 2011</time></div></div></div></header><div class="post__body"><div class="post__inner"><div class="post__entry"><p>I haven't seen a massive amount of documentation on MSDN or other posts about this, so I thought I would write a small note.</p><p>This details a way of extracting the info you see in the news feed on your 'My Site'</p><p>First of all you need to get the the format used by the <strong>ActivityEvent</strong>, this done using <strong>ActivityType</strong> and <strong>ActivityTemplate</strong>.</p><p><code><br><span style="color:#008080;">ActivityType</span> type = activityMan.ActivityTypes[activity.ActivityEventId];<br>ActivityTemplate template = type.ActivityTemplates[<span style="color:#008080;">ActivityTemplatesCollection</span>.CreateKey(false)];<br>string format = GetResourceString(template.TitleFormatLocStringResourceFile, template.TitleFormatLocStringName, (<span style="color:#3366ff;">uint</span>)<span style="color:#008080;">CultureInfo</span>.CurrentUICulture.LCID);<br></code></p><p>The format variable will now contain something along the lines of "{Pubisher} has posted a note {Link} on {PublishDate}"</p><p>Now you could at this point take the corresponding Properties in the <strong>ActivityEvent</strong>, but there is a whole load of formatting that needs to be done. The Publisher Tag needs to be turned into a link to the users profile page and display their name, etc, etc.</p><p>There is an easier way, you can use the static methods of the <strong>ActivityTemplateVariable</strong>.</p><p><code><br><span style="color:#008080;">ActivityTemplateVariable</span>.DateOnlyToString(tag, variable, ContentType.Html, <span style="color:#008080;">CultureInfo</span>.CurrentCulture);<br></code></p><p>The problem here is that you have to pass in an <strong>ActivityTemplateVariable</strong> as one of the parameter and there is no obvious way of doing this.</p><p>There are no properties or methods in the <strong>ActivityEvent</strong> that give you an <strong>ActivityTemplateVariable</strong> or is there?</p><p>After further investigation of the <strong>TemplateVariable</strong> string property, you can see that this actually returns an XML string. This XML string is a de-serialised <strong>ActivityTemplateVariable</strong> object.</p><p><code><br><span style="color:#0000ff;">var</span> variable = (<span style="color:#008080;">ActivityTemplateVariable</span>)FromXml(item.TemplateVariable, <span style="color:#0000ff;">typeof</span>(ActivityTemplateVariable));<br></code></p><p>You can now use this object to pass to the static method of <strong>ActivityTemplateVariable</strong> to return the full HTML representation of the tag.</p><p>If you then combine that with <strong>SimpleTemplateFormat</strong> you can then loop round all the tags and replace them.</p><p><code><br><span style="color:#0000ff;">var</span> items = <span style="color:#008080;">SimpleTemplateFormat</span>.SimpleParse(formatToUse);<br></code></p><p>I'll try and upload a code sample soon.</p></div><footer class="post__footer"><div class="post__updated">Updated: <time datetime="2021-05-04T08:35">May 4, 2021</time></div><div class="post__tag"><span>Tags:</span><ul class="post__tag__list"><li><a href="https://wutek.co.uk/tags/activityevent/" title="ActivityEvent">ActivityEvent</a></li><li><a href="https://wutek.co.uk/tags/activitytemplatevariable/" title="ActivityTemplateVariable">ActivityTemplateVariable</a></li><li><a href="https://wutek.co.uk/tags/api/" title="API">API</a></li><li><a href="https://wutek.co.uk/tags/mysite/" title="MySite">MySite</a></li><li><a href="https://wutek.co.uk/tags/newsfeed/" title="Newsfeed">Newsfeed</a></li><li><a href="https://wutek.co.uk/tags/sharepoint/" title="SharePoint">SharePoint</a></li></ul></div><div class="post__meta"><div class="post__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section post__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/powerpivot-management-dashboard-error-with-infrastructure-server-health-report/" class="invert">PowerPivot Management Dashboard: Error with &quot;Infrastructure - Server Health&quot; report</a></h2><p>When loading this page in Central Administration, I...</p><footer class="card__footer"><time datetime="2013-09-27T10:41">September 27, 2013 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fpowerpivot-management-dashboard-error-with-infrastructure-server-health-report%2F&title=PowerPivot%20Management%20Dashboard%3A%20Error%20with%20%22Infrastructure%20-%20Server%20Health%22%20report" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/search-the-recycle-bin-with-powershell/" class="invert">Search the recycle bin with Powershell</a></h2><p>Useful piece of Powershell to search for a...</p><footer class="card__footer"><time datetime="2012-10-17T10:41">October 17, 2012 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fsearch-the-recycle-bin-with-powershell%2F&title=Search%20the%20recycle%20bin%20with%20Powershell" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/indexing-external-content-with-a-case-sensitive-url/" class="invert">Indexing external content with a case sensitive URL</a></h2><p>There is currently a bug in MOSS 2007...</p><footer class="card__footer"><time datetime="2007-05-29T19:39">May 29, 2007 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Findexing-external-content-with-a-case-sensitive-url%2F&title=Indexing%20external%20content%20with%20a%20case%20sensitive%20URL" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://wutek.co.uk/">Toby Statham</a><div class="footer__copyright"><p>Powered by Publii</p></div><div class="footer__nav"><ul class="footer__nav"><li><a href="https://wutek.co.uk/" target="_self">Home</a></li><li><a href="https://wutek.co.uk/tags/" target="_self">Tags</a></li><li><a href="https://wutek.co.uk/about-me/" target="_self">About</a></li></ul></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top"><svg><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#toparrow"/></svg></svg></button></footer><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=11cb42b202c1c2462a7002b62194e351"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>