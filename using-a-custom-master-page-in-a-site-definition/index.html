<!DOCTYPE html><html lang="en-gb" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Using a custom master page in a site definition - Toby Statham</title><meta name="description" content="Using a site definition in a SharePoint solution for a custom master page"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://wutek.co.uk/using-a-custom-master-page-in-a-site-definition/"><meta property="og:title" content="Using a custom master page in a site definition"><meta property="og:image" content="https://wutek.co.uk/media/posts/1/pages.jpg"><meta property="og:site_name" content="Toby Statham"><meta property="og:description" content="Using a site definition in a SharePoint solution for a custom master page"><meta property="og:url" content="https://wutek.co.uk/using-a-custom-master-page-in-a-site-definition/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@this_is_wutek"><meta name="twitter:title" content="Using a custom master page in a site definition"><meta name="twitter:description" content="Using a site definition in a SharePoint solution for a custom master page"><meta name="twitter:image" content="https://wutek.co.uk/media/posts/1/pages.jpg"><link rel="alternate" type="application/atom+xml" href="https://wutek.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://wutek.co.uk/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root {
               --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
               --heading-font: 'Playfair Display', serif;
               --logo-font: var(--body-font);
               --menu-font: var(--heading-font);
            }</style><link rel="stylesheet" href="https://wutek.co.uk/assets/css/style.css?v=076b19ff0048426f36c3ff3f27f97211"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://wutek.co.uk/using-a-custom-master-page-in-a-site-definition/"},"headline":"Using a custom master page in a site definition","datePublished":"2007-04-30T18:33","dateModified":"2021-05-07T13:32","image":{"@type":"ImageObject","url":"https://wutek.co.uk/media/posts/1/pages.jpg","height":400,"width":640},"description":"SummaryUsing a site definition in a SharePoint solution for a custom master page in SharePoint 2007 UPDATE Don't use the SharePoint Solution Generator, so far we have not been able to upgrade the site definitions through a solution without it killing existing sites based on the site definition. I have&hellip;","author":{"@type":"Person","name":"Toby Statham"},"publisher":{"@type":"Organization","name":"Toby Statham"}}</script></head><body><header class="header" id="js-header"><div><a class="logo" href="https://wutek.co.uk/">Toby Statham</a><div class="search"><div class="search__overlay js-search-overlay"><form action="https://wutek.co.uk/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="Search articles..." aria-label="Search input" autofocus="autofocus"> <button class="search__submit" aria-label="Search">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg height="17" width="17"><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#search"/></svg></button></div></div></header><main><article class="post"><header class="post__inner post__header--centered"><h1 class="h0 post__title">Using a custom master page in a site definition</h1><div class="post__meta"><div class="post__meta__author"><div><a href="https://wutek.co.uk/authors/toby-statham/" class="post__author">Toby Statham</a> <time datetime="2007-04-30T18:33" class="post__date">April 30, 2007</time></div></div></div></header><div class="post__body"><div class="post__inner"><figure class="post__featured-image"><img src="https://wutek.co.uk/media/posts/1/pages.jpg" srcset="https://wutek.co.uk/media/posts/1/responsive/pages-xs.jpg 300w, https://wutek.co.uk/media/posts/1/responsive/pages-sm.jpg 480w, https://wutek.co.uk/media/posts/1/responsive/pages-md.jpg 768w, https://wutek.co.uk/media/posts/1/responsive/pages-xl.jpg 1200w" sizes="(max-width: 1200px) 100vw, 1200px" loading="eager" height="400" width="640" alt=""></figure><div class="post__entry"><h2>Summary</h2><p>Using a site definition in a SharePoint solution for a custom master page in SharePoint 2007</p><h2>Method</h2><p><span style="color: #e03e2d;">UPDATE</span></p><p><span style="color: #e03e2d;">Don't use the SharePoint Solution Generator, so far we have not been able to upgrade the site definitions through a solution without it killing existing sites based on the site definition.</span></p><p>I have seen many different ways of doing this, but I found the following method seemed to work for me, using the "SharePoint Extensions for Visual Studio 2005" <span style="text-decoration: line-through;">and the "SharePoint Solutions Generator"</span></p><h3>Open the Visual Studio Project</h3><ul><li><span style="text-decoration: line-through;">Use the "SharePoint Solution Generator" to create a site definition project.</span></li><li>Open the project and add your custom master page to the "Site Definition" folder</li></ul><p><img loading="lazy" src="https://wutek.co.uk/media/posts/1/043007-1833-usingacusto1.jpg" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto1-xs.jpg 300w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto1-sm.jpg 480w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto1-md.jpg 768w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto1-xl.jpg 1200w"></p><h3>Edit the onet.xml file</h3><ul><li>Open up "onet.xml"</li><li>Add the following node to the "ListTemplates" section</li></ul><pre><code class="language-markup">
  &lt;ListTemplate
  	Name=”mplib”
  	DisplayName=”$Resources:MasterPageGallery;”
  	Description=”$Resources:global_onet_mplib_desc;”
  	SetupPath=”global\lists\mplib”
  	Type=”116”
  	BaseType=”1”
  	Path=”GLOBAL”
  	Hidden=”TRUE”
  	HiddenList=”TRUE”
  	NoCrawl=”TRUE”
  	Unique=”TRUE”
  	Catalog=”TRUE”
  	OnQuickLaunch=”FALSE”
  	SecurityBits=”11”
  	AllowDeletion=”FALSE”
  	AllowEveryoneViewItems=”TRUE”
  	Image=”/_layouts/images/itdl.gif”
  	AlwaysIncludeContent=”TRUE”
  	DocumentTemplate=”100”
  /&gt;
  </code></pre><h3>Edit the Configuration node</h3><ul><li>Add the "MasterUrl" attribute to the "Configuration" node with a value of "_catalogs/masterpage/project.master", where project.master is the name of your custom master page. This means all the pages using the "~masterurl/default.master" token will use the URL defined to point to your custom master page</li></ul><pre><code class="language-markup">
  &lt;Configuration
    ID=”0” 
    Name=”Default” 
    MasterUrl=”_catalogs/masterpage/project.master“
  &gt;
</code></pre><h3>Add the Module Node</h3><ul><li>Add a "Module" node to the Modules section of the configuration called "MasterPage" that will reference the module definition in the "Modules" section of the onet file</li></ul><pre><code class="language-markup">&lt;Module Name=”MasterPage” /&gt;</code></pre><ul><li>Add a module definition to the "Modules" section of the onet file. This will copy the custom master page file into the master page library when the site is provisioned.</li></ul><pre><code class="language-markup">
  &lt;Module 
    Name=”MasterPage” 
    List=”116” 
    Url=”_catalogs/masterpage” 
    RootWebOnly=”FALSE“&gt;
    &lt;File 
        Url=”project.master” 
        Type=”GhostableInLibrary” 
        IgnoreIfAlreadyExists=”TRUE” 
    /&gt;
&lt;/Module&gt;</code></pre><h3>Save and deploy the project</h3><ul><li>Save the onet file and then deploy the project into your environment using the deploy option in "SharePoint Extensions for VS 2005"</li><li>When you create a new site from your site definition it should now use your new master page.</li></ul><p>Below is a screen grab of the onet.xml file with all the changes highlighted</p><p style="margin-left: 19pt;"><img loading="lazy" src="https://wutek.co.uk/media/posts/1/043007-1833-usingacusto2.jpg" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto2-xs.jpg 300w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto2-sm.jpg 480w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto2-md.jpg 768w, https://wutek.co.uk/media/posts/1/responsive/043007-1833-usingacusto2-xl.jpg 1200w" width="485" height="378"> </p></div><footer class="post__footer"><div class="post__updated">Updated: <time datetime="2021-05-07T13:32">May 7, 2021</time></div><div class="post__tag"><span>Tags:</span><ul class="post__tag__list"><li><a href="https://wutek.co.uk/tags/development/" title="Development">Development</a></li><li><a href="https://wutek.co.uk/tags/master-pages/" title="Master Pages">Master Pages</a></li><li><a href="https://wutek.co.uk/tags/sharepoint-2007/" title="SharePoint 2007">SharePoint 2007</a></li><li><a href="https://wutek.co.uk/tags/site-definitions/" title="Site Definitions">Site Definitions</a></li></ul></div><div class="post__meta"><div class="post__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section post__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/enable-audience-targeting-using-script-or-code/" class="invert">Enable Audience targeting using script or code</a></h2><p>Currently there are no direct methods to enable...</p><footer class="card__footer"><time datetime="2019-07-18T09:26">July 18, 2019 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fenable-audience-targeting-using-script-or-code%2F&title=Enable%20Audience%20targeting%20using%20script%20or%20code" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/field-in-list-not-available-in-listitem-using-managed-client-object-model/" class="invert">Field in List not available in ListItem using Managed Client Object Model</a></h2><p>If you have a field called &quot;Folder&quot; it...</p><footer class="card__footer"><time datetime="2013-01-25T15:17">January 25, 2013 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Ffield-in-list-not-available-in-listitem-using-managed-client-object-model%2F&title=Field%20in%20List%20not%20available%20in%20ListItem%20using%20Managed%20Client%20Object%20Model" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/using-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two/" class="invert">Using the BDC to populate user profiles from a SQL Server database - Part Two</a></h2><p>This is the second part of a two...</p><footer class="card__footer"><time datetime="2007-11-02T09:46">November 2, 2007 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fusing-the-bdc-to-populate-user-profiles-from-a-sql-server-database-part-two%2F&title=Using%20the%20BDC%20to%20populate%20user%20profiles%20from%20a%20SQL%20Server%20database%20-%20Part%20Two" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://wutek.co.uk/be-careful-when-editing-the-applicationmaster-page/" class="invert">Be careful when editing the application.master page</a></h2><p>Here&#x27;s an odd one. We had customized our...</p><footer class="card__footer"><time datetime="2007-10-29T09:00">October 29, 2007 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Fwutek.co.uk%2Fbe-careful-when-editing-the-applicationmaster-page%2F&title=Be%20careful%20when%20editing%20the%20application.master%20page" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://wutek.co.uk/">Toby Statham</a><div class="footer__copyright"><p>Powered by Publii</p></div><div class="footer__nav"><ul class="footer__nav"><li><a href="https://wutek.co.uk/" target="_self">Home</a></li><li><a href="https://wutek.co.uk/tags/" target="_self">Tags</a></li><li><a href="https://wutek.co.uk/about-me/" target="_self">About</a></li></ul></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top"><svg><svg><use xlink:href="https://wutek.co.uk/assets/svg/svg-map.svg#toparrow"/></svg></svg></button></footer><script defer="defer" src="https://wutek.co.uk/assets/js/scripts.min.js?v=11cb42b202c1c2462a7002b62194e351"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>